syntax = "proto3";
package agoric.vstream;

import "gogoproto/gogo.proto";

option go_package = "github.com/Agoric/agoric-sdk/golang/cosmos/x/vstream/types";

// StreamCell represents one publish state in a vstream stream.
message StreamCell {
    option (gogoproto.equal) = false;

    // StreamState is the state of the stream as of this cell.
    enum StreamState {
      // STREAM_STATE_UNSPECIFIED means streaming state is unknown (probably
      // before any values have been published).
      STREAM_STATE_UNSPECIFIED = 0;
      // STREAM_STATE_STREAMING means the stream is producing more values.
      STREAM_STATE_STREAMING = 1;
      // STREAM_STATE_FINISHED means the stream has terminated with a value.
      STREAM_STATE_FINISHED = 2;
      // STREAM_STATE_FAILURE means the stream has terminated with an error.
      STREAM_STATE_FAILURE = 3;
    }

    // Chronologically-ordered list of values for this cell.
    repeated bytes values = 1;

    // The block height in which this cell was last updated.
    int64 updated_block_height = 2 [
        (gogoproto.jsontag)    = "updated_block_height",
        (gogoproto.moretags)   = "yaml:\"updated_block_height\""
    ];

    // The state of the stream.
    StreamState state = 3;

    // The terminal error, if state=STREAM_STATE_FAILURE.
    string error = 4;

    // The reference to the prior cell in the stream.
    StreamCellReference prior = 5 [
      (gogoproto.nullable) = false
    ];
}

// StreamCellReference is data that refers to a particular stream cell value.
message StreamCellReference {
    // The height at which the cell is stored.
    int64 block_height = 1 [
        (gogoproto.jsontag)    = "block_height",
        (gogoproto.moretags)   = "yaml:\"block_height\""
    ];

    // The store name under which the cell is stored.
    string store_name = 2 [
        (gogoproto.jsontag)    = "store_name",
        (gogoproto.moretags)   = "yaml:\"store_name\""
    ];

    // The subkey under which the cell is stored.
    bytes store_subkey = 3 [
        (gogoproto.jsontag)    = "store_subkey",
        (gogoproto.moretags)   = "yaml:\"store_subkey\""
    ];

    // The count of the values before the referenced one.
    uint64 values_count = 4 [
        (gogoproto.jsontag)    = "values_count",
        (gogoproto.moretags)   = "yaml:\"values_count\""
    ];
}
