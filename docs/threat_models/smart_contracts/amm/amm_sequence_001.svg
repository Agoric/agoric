<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1429px" preserveAspectRatio="none" style="width:1515px;height:1429px;background:#FFFFFF;" version="1.1" viewBox="0 0 1515 1429" width="1515px" zoomAndPan="magnify"><defs><filter height="300%" id="f13sl5rpqc4wly" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="337" x="585.75" y="44.1797">AMM Sequence Diagram Swap Request</text><rect fill="#DDDDDD" height="1351.1563" style="stroke:#A80036;stroke-width:1.0;" width="309.5" x="757" y="55.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="899.75" y="68.5449">Zoe</text><rect fill="#FFFFFF" filter="url(#f13sl5rpqc4wly)" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="554" x="207" y="200.7754"/><rect fill="#FFFFFF" filter="url(#f13sl5rpqc4wly)" height="134.5527" style="stroke:#000000;stroke-width:2.0;" width="1291.5" x="207" y="290.707"/><rect fill="#FFFFFF" filter="url(#f13sl5rpqc4wly)" height="59.6211" style="stroke:#000000;stroke-width:2.0;" width="357.5" x="207" y="439.2598"/><rect fill="#FFFFFF" filter="url(#f13sl5rpqc4wly)" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="554" x="207" y="512.8809"/><rect fill="#FFFFFF" filter="url(#f13sl5rpqc4wly)" height="466.6582" style="stroke:#000000;stroke-width:2.0;" width="1159.5" x="207" y="602.8125"/><rect fill="#FFFFFF" filter="url(#f13sl5rpqc4wly)" height="219.1738" style="stroke:#000000;stroke-width:2.0;" width="865.5" x="207" y="1083.4707"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="53" x2="53" y1="138.4648" y2="1320.6445"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="159" x2="159" y1="138.4648" y2="1320.6445"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="252" x2="252" y1="138.4648" y2="1320.6445"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="699" x2="699" y1="138.4648" y2="1320.6445"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="777" x2="777" y1="138.4648" y2="1320.6445"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1029.5" x2="1029.5" y1="138.4648" y2="1320.6445"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1126.5" x2="1126.5" y1="138.4648" y2="1320.6445"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1287.5" x2="1287.5" y1="138.4648" y2="1320.6445"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1427.5" x2="1427.5" y1="138.4648" y2="1320.6445"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="5" y="135.5117">AMM Creator</text><ellipse cx="53" cy="64.9766" fill="#00FF00" filter="url(#f13sl5rpqc4wly)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M53,72.9766 L53,99.9766 M40,80.9766 L66,80.9766 M53,99.9766 L40,114.9766 M53,99.9766 L66,114.9766 " fill="none" filter="url(#f13sl5rpqc4wly)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="5" y="1333.1797">AMM Creator</text><ellipse cx="53" cy="1346.1328" fill="#00FF00" filter="url(#f13sl5rpqc4wly)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M53,1354.1328 L53,1381.1328 M40,1362.1328 L66,1362.1328 M53,1381.1328 L40,1396.1328 M53,1381.1328 L66,1396.1328 " fill="none" filter="url(#f13sl5rpqc4wly)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="111" y="135.5117">Pool Adder N</text><ellipse cx="159" cy="64.9766" fill="#FFFF00" filter="url(#f13sl5rpqc4wly)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M159,72.9766 L159,99.9766 M146,80.9766 L172,80.9766 M159,99.9766 L146,114.9766 M159,99.9766 L172,114.9766 " fill="none" filter="url(#f13sl5rpqc4wly)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="111" y="1333.1797">Pool Adder N</text><ellipse cx="159" cy="1346.1328" fill="#FFFF00" filter="url(#f13sl5rpqc4wly)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M159,1354.1328 L159,1381.1328 M146,1362.1328 L172,1362.1328 M159,1381.1328 L146,1396.1328 M159,1381.1328 L172,1396.1328 " fill="none" filter="url(#f13sl5rpqc4wly)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="217" y="135.5117">Pool User</text><ellipse cx="252.5" cy="64.9766" fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M252.5,72.9766 L252.5,99.9766 M239.5,80.9766 L265.5,80.9766 M252.5,99.9766 L239.5,114.9766 M252.5,99.9766 L265.5,114.9766 " fill="none" filter="url(#f13sl5rpqc4wly)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="217" y="1333.1797">Pool User</text><ellipse cx="252.5" cy="1346.1328" fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M252.5,1354.1328 L252.5,1381.1328 M239.5,1362.1328 L265.5,1362.1328 M252.5,1381.1328 L239.5,1396.1328 M252.5,1381.1328 L265.5,1396.1328 " fill="none" filter="url(#f13sl5rpqc4wly)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="648" y="135.5117">AMM Contract</text><path d="M681.5,85.9766 C681.5,75.9766 699.5,75.9766 699.5,75.9766 C699.5,75.9766 717.5,75.9766 717.5,85.9766 L717.5,111.9766 C717.5,121.9766 699.5,121.9766 699.5,121.9766 C699.5,121.9766 681.5,121.9766 681.5,111.9766 L681.5,85.9766 " fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" style="stroke:#000000;stroke-width:1.5;"/><path d="M681.5,85.9766 C681.5,95.9766 699.5,95.9766 699.5,95.9766 C699.5,95.9766 717.5,95.9766 717.5,85.9766 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="648" y="1333.1797">AMM Contract</text><path d="M681.5,1346.1328 C681.5,1336.1328 699.5,1336.1328 699.5,1336.1328 C699.5,1336.1328 717.5,1336.1328 717.5,1346.1328 L717.5,1372.1328 C717.5,1382.1328 699.5,1382.1328 699.5,1382.1328 C699.5,1382.1328 681.5,1382.1328 681.5,1372.1328 L681.5,1346.1328 " fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" style="stroke:#000000;stroke-width:1.5;"/><path d="M681.5,1346.1328 C681.5,1356.1328 699.5,1356.1328 699.5,1356.1328 C699.5,1356.1328 717.5,1356.1328 717.5,1346.1328 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="761.5" y="135.5117">Zoe</text><ellipse cx="777" cy="105.9766" fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="765" x2="789" y1="119.9766" y2="119.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="761.5" y="1333.1797">Zoe</text><ellipse cx="777" cy="1352.1328" fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="765" x2="789" y1="1366.1328" y2="1366.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="997.5" y="135.5117">userSeat</text><ellipse cx="1030" cy="105.9766" fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1018" x2="1042" y1="119.9766" y2="119.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="997.5" y="1333.1797">userSeat</text><ellipse cx="1030" cy="1352.1328" fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1018" x2="1042" y1="1366.1328" y2="1366.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="1072.5" y="135.5117">Pool SML:BUCK</text><path d="M1108.5,85.9766 C1108.5,75.9766 1126.5,75.9766 1126.5,75.9766 C1126.5,75.9766 1144.5,75.9766 1144.5,85.9766 L1144.5,111.9766 C1144.5,121.9766 1126.5,121.9766 1126.5,121.9766 C1126.5,121.9766 1108.5,121.9766 1108.5,111.9766 L1108.5,85.9766 " fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1108.5,85.9766 C1108.5,95.9766 1126.5,95.9766 1126.5,95.9766 C1126.5,95.9766 1144.5,95.9766 1144.5,85.9766 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="1072.5" y="1333.1797">Pool SML:BUCK</text><path d="M1108.5,1346.1328 C1108.5,1336.1328 1126.5,1336.1328 1126.5,1336.1328 C1126.5,1336.1328 1144.5,1336.1328 1144.5,1346.1328 L1144.5,1372.1328 C1144.5,1382.1328 1126.5,1382.1328 1126.5,1382.1328 C1126.5,1382.1328 1108.5,1382.1328 1108.5,1372.1328 L1108.5,1346.1328 " fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1108.5,1346.1328 C1108.5,1356.1328 1126.5,1356.1328 1126.5,1356.1328 C1126.5,1356.1328 1144.5,1356.1328 1144.5,1346.1328 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="1218.5" y="135.5117">poolSeat SML:BUCK</text><ellipse cx="1287.5" cy="105.9766" fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1275.5" x2="1299.5" y1="119.9766" y2="119.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="1218.5" y="1333.1797">poolSeat SML:BUCK</text><ellipse cx="1287.5" cy="1352.1328" fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1275.5" x2="1299.5" y1="1366.1328" y2="1366.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1366.5" y="135.5117">Pool MOOL:BUCK</text><path d="M1409.5,85.9766 C1409.5,75.9766 1427.5,75.9766 1427.5,75.9766 C1427.5,75.9766 1445.5,75.9766 1445.5,85.9766 L1445.5,111.9766 C1445.5,121.9766 1427.5,121.9766 1427.5,121.9766 C1427.5,121.9766 1409.5,121.9766 1409.5,111.9766 L1409.5,85.9766 " fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1409.5,85.9766 C1409.5,95.9766 1427.5,95.9766 1427.5,95.9766 C1427.5,95.9766 1445.5,95.9766 1445.5,85.9766 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1366.5" y="1333.1797">Pool MOOL:BUCK</text><path d="M1409.5,1346.1328 C1409.5,1336.1328 1427.5,1336.1328 1427.5,1336.1328 C1427.5,1336.1328 1445.5,1336.1328 1445.5,1346.1328 L1445.5,1372.1328 C1445.5,1382.1328 1427.5,1382.1328 1427.5,1382.1328 C1427.5,1382.1328 1409.5,1382.1328 1409.5,1372.1328 L1409.5,1346.1328 " fill="#FEFECE" filter="url(#f13sl5rpqc4wly)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1409.5,1346.1328 C1409.5,1356.1328 1427.5,1356.1328 1427.5,1356.1328 C1427.5,1356.1328 1445.5,1356.1328 1445.5,1346.1328 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="0" x2="1508.5" y1="149.4648" y2="149.4648"/><rect fill="#EEEEEE" filter="url(#f13sl5rpqc4wly)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1508.5" x="0" y="171.1201"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1508.5" y1="171.1201" y2="171.1201"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1508.5" y1="174.1201" y2="174.1201"/><rect fill="#EEEEEE" filter="url(#f13sl5rpqc4wly)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="112" x="698.25" y="160.4648"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="94" x="704.25" y="177.0332">Swap Request</text><path d="M207,200.7754 L510,200.7754 L510,207.7754 L500,217.7754 L207,217.7754 L207,200.7754 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="554" x="207" y="200.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="258" x="222" y="214.3438">asking for the current price UNK:BUCK</text><polygon fill="#A80036" points="687.5,235.3965,697.5,239.3965,687.5,243.3965,691.5,239.3965" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="252.5" x2="693.5" y1="239.3965" y2="239.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="259.5" y="234.6543">50</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="192" x="281.5" y="234.2417">getOutputPrice(UNK:BUCK)</text><line style="stroke:#A80036;stroke-width:2.0;" x1="258.5" x2="268.5" y1="263.707" y2="273.707"/><line style="stroke:#A80036;stroke-width:2.0;" x1="258.5" x2="268.5" y1="273.707" y2="263.707"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="264.5" x2="698.5" y1="268.707" y2="268.707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="269.5" y="263.9648">51</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="291.5" y="263.5522">brands were not recognized</text><path d="M207,290.707 L523,290.707 L523,297.707 L513,307.707 L207,307.707 L207,290.707 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="134.5527" style="stroke:#000000;stroke-width:2.0;" width="1291.5" x="207" y="290.707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="271" x="222" y="304.2754">asking for the current price MOOL:BUCK</text><polygon fill="#A80036" points="687.5,325.3281,697.5,329.3281,687.5,333.3281,691.5,329.3281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="252.5" x2="693.5" y1="329.3281" y2="329.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="259.5" y="324.5859">52</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="200" x="281.5" y="324.1733">getOutputPrice(MOOL:BUCK)</text><polygon fill="#A80036" points="1415.5,354.6387,1425.5,358.6387,1415.5,362.6387,1419.5,358.6387" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="699.5" x2="1421.5" y1="358.6387" y2="358.6387"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="706.5" y="353.8965">53</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="224" x="728.5" y="353.4839">getPriceForOutput(MOOL:BUCK)</text><polygon fill="#A80036" points="710.5,383.9492,700.5,387.9492,710.5,391.9492,706.5,387.9492" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="704.5" x2="1426.5" y1="387.9492" y2="387.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="716.5" y="383.207">54</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="40" x="738.5" y="382.7944">quote</text><polygon fill="#A80036" points="263.5,413.2598,253.5,417.2598,263.5,421.2598,259.5,417.2598" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="257.5" x2="698.5" y1="417.2598" y2="417.2598"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="269.5" y="412.5176">55</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="40" x="291.5" y="412.105">quote</text><path d="M207,439.2598 L378,439.2598 L378,446.2598 L368,456.2598 L207,456.2598 L207,439.2598 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="59.6211" style="stroke:#000000;stroke-width:2.0;" width="357.5" x="207" y="439.2598"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126" x="222" y="452.8281">making a proposal</text><line style="stroke:#A80036;stroke-width:1.0;" x1="252.5" x2="294.5" y1="477.8809" y2="477.8809"/><line style="stroke:#A80036;stroke-width:1.0;" x1="294.5" x2="294.5" y1="477.8809" y2="490.8809"/><line style="stroke:#A80036;stroke-width:1.0;" x1="253.5" x2="294.5" y1="490.8809" y2="490.8809"/><polygon fill="#A80036" points="263.5,486.8809,253.5,490.8809,263.5,494.8809,259.5,490.8809" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="259.5" y="473.1387">56</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="281.5" y="473.1387">create proposal for SML:BUCK as</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="488.5" y="472.8149">proposal</text><path d="M207,512.8809 L514,512.8809 L514,519.8809 L504,529.8809 L207,529.8809 L207,512.8809 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="554" x="207" y="512.8809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="262" x="222" y="526.4492">requesting an invitation for a SwapOut</text><polygon fill="#A80036" points="687.5,547.502,697.5,551.502,687.5,555.502,691.5,551.502" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="252.5" x2="693.5" y1="551.502" y2="551.502"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="259.5" y="546.7598">57</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="184" x="281.5" y="546.3472">makeSwapOutInvitation()</text><polygon fill="#A80036" points="263.5,576.8125,253.5,580.8125,263.5,584.8125,259.5,580.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="257.5" x2="698.5" y1="580.8125" y2="580.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="269.5" y="576.0703">58</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="80" x="291.5" y="575.6577">invitation</text><path d="M207,602.8125 L360,602.8125 L360,609.8125 L350,619.8125 L207,619.8125 L207,602.8125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="466.6582" style="stroke:#000000;stroke-width:2.0;" width="1159.5" x="207" y="602.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="108" x="222" y="616.3809">making an offer</text><line style="stroke:#A80036;stroke-width:1.0;" x1="252.5" x2="294.5" y1="641.4336" y2="641.4336"/><line style="stroke:#A80036;stroke-width:1.0;" x1="294.5" x2="294.5" y1="641.4336" y2="654.4336"/><line style="stroke:#A80036;stroke-width:1.0;" x1="253.5" x2="294.5" y1="654.4336" y2="654.4336"/><polygon fill="#A80036" points="263.5,650.4336,253.5,654.4336,263.5,658.4336,259.5,654.4336" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="259.5" y="636.6914">59</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="281.5" y="636.6914">withdraw funds from purse of SML into</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="530.5" y="636.3677">payment</text><polygon fill="#A80036" points="765,679.7441,775,683.7441,765,687.7441,769,683.7441" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="252.5" x2="771" y1="683.7441" y2="683.7441"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="259.5" y="679.002">60</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="296" x="281.5" y="678.5894">offer(invitation, proposal, payment))</text><line style="stroke:#A80036;stroke-width:1.0;" x1="777" x2="819" y1="713.0547" y2="713.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="819" x2="819" y1="713.0547" y2="726.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="778" x2="819" y1="726.0547" y2="726.0547"/><polygon fill="#A80036" points="788,722.0547,778,726.0547,788,730.0547,784,726.0547" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="784" y="708.3125">61</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="806" y="708.3125">validate offer</text><polygon fill="#A80036" points="1018,751.3652,1028,755.3652,1018,759.3652,1022,755.3652" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="777" x2="1024" y1="755.3652" y2="755.3652"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="784" y="750.623">62</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="806" y="750.623">create</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="848" y="750.2993">userSeat</text><polygon fill="#A80036" points="788,780.6758,778,784.6758,788,788.6758,784,784.6758" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="782" x2="1029" y1="784.6758" y2="784.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="794" y="779.9336">63</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="816" y="779.521">userSeat</text><polygon fill="#A80036" points="1114.5,809.9863,1124.5,813.9863,1114.5,817.9863,1118.5,813.9863" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="777" x2="1120.5" y1="813.9863" y2="813.9863"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="784" y="809.2441">64</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="806" y="808.8315">getPoolSeat()</text><polygon fill="#A80036" points="1275.5,839.2969,1285.5,843.2969,1275.5,847.2969,1279.5,843.2969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1126.5" x2="1281.5" y1="843.2969" y2="843.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1133.5" y="838.5547">65</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="1155.5" y="838.5547">create</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="1197.5" y="838.231">poolSeat</text><polygon fill="#A80036" points="788,868.6074,778,872.6074,788,876.6074,784,872.6074" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="782" x2="1286.5" y1="872.6074" y2="872.6074"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="794" y="867.8652">66</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="816" y="867.4526">poolSeat</text><polygon fill="#A80036" points="1275.5,897.918,1285.5,901.918,1275.5,905.918,1279.5,901.918" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="699.5" x2="1281.5" y1="901.918" y2="901.918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="706.5" y="897.1758">67</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="728.5" y="897.1758">stage assets</text><polygon fill="#A80036" points="1018,927.2285,1028,931.2285,1018,935.2285,1022,931.2285" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="699.5" x2="1024" y1="931.2285" y2="931.2285"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="706.5" y="926.4863">68</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="728.5" y="926.4863">stage assets</text><line style="stroke:#A80036;stroke-width:1.0;" x1="777" x2="819" y1="960.5391" y2="960.5391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="819" x2="819" y1="960.5391" y2="973.5391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="778" x2="819" y1="973.5391" y2="973.5391"/><polygon fill="#A80036" points="788,969.5391,778,973.5391,788,977.5391,784,973.5391" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="784" y="955.7969">69</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="806" y="955.3843">reallocate(seat, poolSeat)</text><polygon fill="#A80036" points="263.5,998.8496,253.5,1002.8496,263.5,1006.8496,259.5,1002.8496" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="257.5" x2="1029" y1="1002.8496" y2="1002.8496"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="269.5" y="998.1074">70</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="291.5" y="997.6948">userSeat</text><polygon fill="#A80036" points="765,1028.1602,775,1032.1602,765,1036.1602,769,1032.1602" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="252.5" x2="771" y1="1032.1602" y2="1032.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="259.5" y="1027.418">71</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="281.5" y="1027.0054">getOfferResult()</text><polygon fill="#A80036" points="263.5,1057.4707,253.5,1061.4707,263.5,1065.4707,259.5,1061.4707" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="257.5" x2="776" y1="1061.4707" y2="1061.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="269.5" y="1056.7285">72</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="291.5" y="1056.7285">result of failure or success</text><path d="M207,1083.4707 L368,1083.4707 L368,1090.4707 L358,1100.4707 L207,1100.4707 L207,1083.4707 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="219.1738" style="stroke:#000000;stroke-width:2.0;" width="865.5" x="207" y="1083.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="116" x="222" y="1097.0391">recovering funds</text><polygon fill="#A80036" points="1018,1118.0918,1028,1122.0918,1018,1126.0918,1022,1122.0918" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="252.5" x2="1024" y1="1122.0918" y2="1122.0918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="259.5" y="1117.3496">73</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="281.5" y="1117.0259">getPayout("Central")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="445.5" y="1117.3496">(give)</text><polygon fill="#A80036" points="263.5,1147.4023,253.5,1151.4023,263.5,1155.4023,259.5,1151.4023" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="257.5" x2="1029" y1="1151.4023" y2="1151.4023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="269.5" y="1146.6602">74</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="291.5" y="1146.2476">payoutCentral</text><line style="stroke:#A80036;stroke-width:1.0;" x1="252.5" x2="294.5" y1="1180.7129" y2="1180.7129"/><line style="stroke:#A80036;stroke-width:1.0;" x1="294.5" x2="294.5" y1="1180.7129" y2="1193.7129"/><line style="stroke:#A80036;stroke-width:1.0;" x1="253.5" x2="294.5" y1="1193.7129" y2="1193.7129"/><polygon fill="#A80036" points="263.5,1189.7129,253.5,1193.7129,263.5,1197.7129,259.5,1193.7129" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="259.5" y="1175.9707">75</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="281.5" y="1175.9707">deposit</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="332.5" y="1175.647">payoutCentral</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="440.5" y="1175.9707">into purse</text><polygon fill="#A80036" points="1018,1219.0234,1028,1223.0234,1018,1227.0234,1022,1223.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="252.5" x2="1024" y1="1223.0234" y2="1223.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="259.5" y="1218.2813">76</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="281.5" y="1217.9575">getPayout("Secondary")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="461.5" y="1218.2813">(want)</text><polygon fill="#A80036" points="263.5,1248.334,253.5,1252.334,263.5,1256.334,259.5,1252.334" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="257.5" x2="1029" y1="1252.334" y2="1252.334"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="269.5" y="1247.5918">77</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="291.5" y="1247.1792">payoutSecondary</text><line style="stroke:#A80036;stroke-width:1.0;" x1="252.5" x2="294.5" y1="1281.6445" y2="1281.6445"/><line style="stroke:#A80036;stroke-width:1.0;" x1="294.5" x2="294.5" y1="1281.6445" y2="1294.6445"/><line style="stroke:#A80036;stroke-width:1.0;" x1="253.5" x2="294.5" y1="1294.6445" y2="1294.6445"/><polygon fill="#A80036" points="263.5,1290.6445,253.5,1294.6445,263.5,1298.6445,259.5,1294.6445" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="259.5" y="1276.9023">78</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="281.5" y="1276.9023">deposit</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="332.5" y="1276.5786">payoutSecondary</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="456.5" y="1276.9023">into purse</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="0" x2="1508.5" y1="1309.6445" y2="1309.6445"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="176" x="1332.5" y="14.668">Agoric Systems Operating Company.</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="55" x="726.75" y="1420.8008">Page 2 of 4</text><!--MD5=[e35874f8cdeb1234391d1f079449f5df]
@startuml
'https://plantuml.com/sequence-diagram
header Agoric Systems Operating Company.
footer Page %page% of %lastpage%
title AMM Sequence Diagram Creation

autonumber
actor "AMM Creator" as masc #lime
actor "Pool Adder N" as pa #yellow
actor "Pool User" as pu
database "AMM Contract" as AMM
box "Zoe"
entity "Zoe" as zoe
entity "userSeat" as usA
end box

== AMM Creation ==
masc -> AMM: Create instance
return ""creatorFacet""
== Pool Addition SML:BCK==
autonumber 10
pa -> AMM: ""addPool()""
database "Pool SML:BUCK" as pool
entity "poolSeat SML:BUCK" as psA

AMM -> pool: Create pool for SML -> BUCK
AMM - -> pa: ""Issuer""
== Pool Addition MOOL:BCK==
autonumber 10
pa -> AMM: ""addPool()""
database "Pool MOOL:BUCK" as pool2
AMM -> pool2: Create pool for MOOL -> BUCK
AMM - -> pa: ""Issuer""


== Duplicate Pool Addition MOOL:BCK==
autonumber 30
pa -> AMM: ""addPool()""
AMM - ->x pa: pool for MOOL:BCK already exists
newpage AMM Sequence Diagram Swap Request

autonumber 50
== Swap Request ==
group asking for the current price UNK:BUCK
pu -> AMM: ""getOutputPrice(UNK:BUCK)""
AMM - ->x pu: ""brands were not recognized""
end
group asking for the current price MOOL:BUCK


pu -> AMM: ""getOutputPrice(MOOL:BUCK)""
AMM -> pool2: ""getPriceForOutput(MOOL:BUCK)""
pool2 - -> AMM: ""quote""
AMM - -> pu: ""quote""
end

group making a proposal
pu -> pu: create proposal for SML:BUCK as ""proposal""

end

group requesting an invitation for a SwapOut
pu -> AMM: ""makeSwapOutInvitation()""
return ""invitation""

end

group making an offer
pu -> pu: withdraw funds from purse of SML into ""payment""
pu -> zoe: ""offer(invitation, proposal, payment))""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""
AMM -> psA: stage assets
AMM -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

newpage AMM Sequence Diagram Adding Liquidity

autonumber 100
== Adding Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> AMM: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to add 1 BUCK, and 1 SML\nat ratio of ""poolAllocation"" for X ""liquidity""
end
group withdraw funds
pu -> pu: withdraw funds for ""BUCK"" into ""payments"" record
pu -> pu: withdraw funds for ""SML"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
AMM -> psA: stage assets
AMM -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (give)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
pu -> usA: ""getPayout("Liquidity")"" (want)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
end


newpage AMM Sequence Diagram Removing Liquidity

autonumber 200
== Removing Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> AMM: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to remove 1 ""liquidity"" for 1 BUCK and 1 SML\nat ratio of ""poolAllocation""
end
group withdraw funds
pu -> pu: withdraw funds for ""liquidity"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
AMM -> psA: stage assets
AMM -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Liquidity")"" (give)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
pu -> usA: ""getPayout("Central")"" (want)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

@enduml

@startuml
header Agoric Systems Operating Company.
footer Page %page% of %lastpage%
title AMM Sequence Diagram Creation

autonumber
actor "AMM Creator" as masc #lime
actor "Pool Adder N" as pa #yellow
actor "Pool User" as pu
database "AMM Contract" as AMM
box "Zoe"
entity "Zoe" as zoe
entity "userSeat" as usA
end box

== AMM Creation ==
masc -> AMM: Create instance
return ""creatorFacet""
== Pool Addition SML:BCK==
autonumber 10
pa -> AMM: ""addPool()""
database "Pool SML:BUCK" as pool
entity "poolSeat SML:BUCK" as psA

AMM -> pool: Create pool for SML -> BUCK
AMM - -> pa: ""Issuer""
== Pool Addition MOOL:BCK==
autonumber 10
pa -> AMM: ""addPool()""
database "Pool MOOL:BUCK" as pool2
AMM -> pool2: Create pool for MOOL -> BUCK
AMM - -> pa: ""Issuer""


== Duplicate Pool Addition MOOL:BCK==
autonumber 30
pa -> AMM: ""addPool()""
AMM - ->x pa: pool for MOOL:BCK already exists
newpage AMM Sequence Diagram Swap Request

autonumber 50
== Swap Request ==
group asking for the current price UNK:BUCK
pu -> AMM: ""getOutputPrice(UNK:BUCK)""
AMM - ->x pu: ""brands were not recognized""
end
group asking for the current price MOOL:BUCK


pu -> AMM: ""getOutputPrice(MOOL:BUCK)""
AMM -> pool2: ""getPriceForOutput(MOOL:BUCK)""
pool2 - -> AMM: ""quote""
AMM - -> pu: ""quote""
end

group making a proposal
pu -> pu: create proposal for SML:BUCK as ""proposal""

end

group requesting an invitation for a SwapOut
pu -> AMM: ""makeSwapOutInvitation()""
return ""invitation""

end

group making an offer
pu -> pu: withdraw funds from purse of SML into ""payment""
pu -> zoe: ""offer(invitation, proposal, payment))""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""
AMM -> psA: stage assets
AMM -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

newpage AMM Sequence Diagram Adding Liquidity

autonumber 100
== Adding Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> AMM: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to add 1 BUCK, and 1 SML\nat ratio of ""poolAllocation"" for X ""liquidity""
end
group withdraw funds
pu -> pu: withdraw funds for ""BUCK"" into ""payments"" record
pu -> pu: withdraw funds for ""SML"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
AMM -> psA: stage assets
AMM -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (give)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
pu -> usA: ""getPayout("Liquidity")"" (want)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
end


newpage AMM Sequence Diagram Removing Liquidity

autonumber 200
== Removing Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> AMM: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to remove 1 ""liquidity"" for 1 BUCK and 1 SML\nat ratio of ""poolAllocation""
end
group withdraw funds
pu -> pu: withdraw funds for ""liquidity"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
AMM -> psA: stage assets
AMM -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Liquidity")"" (give)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
pu -> usA: ""getPayout("Central")"" (want)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

@enduml

PlantUML version 1.2021.10(Mon Aug 30 06:43:48 PDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>