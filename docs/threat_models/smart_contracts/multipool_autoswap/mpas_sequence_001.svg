<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1414px" preserveAspectRatio="none" style="width:1521px;height:1414px;background:#FFFFFF;" version="1.1" viewBox="0 0 1521 1414" width="1521px" zoomAndPan="magnify"><defs/><g><rect height="26.4883" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="403" x="555.25" y="22.7773"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="393" x="560.25" y="41.3125">Multipool Auto Swap Sequence Diagram Swap Request</text><rect fill="#DDDDDD" height="1337.1563" style="stroke:#181818;stroke-width:0.5;" width="309.5" x="763" y="56.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="905.75" y="68.834">Zoe</text><rect height="75.9316" style="stroke:#000000;stroke-width:1.5;fill:none;" width="556" x="211" y="194.0645"/><rect height="134.5527" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1293.5" x="211" y="283.9961"/><rect height="59.6211" style="stroke:#000000;stroke-width:1.5;fill:none;" width="357.5" x="211" y="432.5488"/><rect height="75.9316" style="stroke:#000000;stroke-width:1.5;fill:none;" width="556" x="211" y="506.1699"/><rect height="466.6582" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1161.5" x="211" y="596.1016"/><rect height="219.1738" style="stroke:#000000;stroke-width:1.5;fill:none;" width="867.5" x="211" y="1076.7598"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="55" x2="55" y1="131.7539" y2="1313.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="163" x2="163" y1="131.7539" y2="1313.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="256" x2="256" y1="131.7539" y2="1313.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="703" x2="703" y1="131.7539" y2="1313.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="783" x2="783" y1="131.7539" y2="1313.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1035.5" x2="1035.5" y1="131.7539" y2="1313.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1132.5" x2="1132.5" y1="131.7539" y2="1313.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1293.5" x2="1293.5" y1="131.7539" y2="1313.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1433.5" x2="1433.5" y1="131.7539" y2="1313.9336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="5" y="128.8008">MPAS Creator</text><ellipse cx="55" cy="63.7656" fill="#00FF00" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M55,71.7656 L55,98.7656 M42,79.7656 L68,79.7656 M55,98.7656 L42,113.7656 M55,98.7656 L68,113.7656 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="5" y="1326.4688">MPAS Creator</text><ellipse cx="55" cy="1337.9219" fill="#00FF00" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M55,1345.9219 L55,1372.9219 M42,1353.9219 L68,1353.9219 M55,1372.9219 L42,1387.9219 M55,1372.9219 L68,1387.9219 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="115" y="128.8008">Pool Adder N</text><ellipse cx="163" cy="63.7656" fill="#FFFF00" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M163,71.7656 L163,98.7656 M150,79.7656 L176,79.7656 M163,98.7656 L150,113.7656 M163,98.7656 L176,113.7656 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="115" y="1326.4688">Pool Adder N</text><ellipse cx="163" cy="1337.9219" fill="#FFFF00" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M163,1345.9219 L163,1372.9219 M150,1353.9219 L176,1353.9219 M163,1372.9219 L150,1387.9219 M163,1372.9219 L176,1387.9219 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="221" y="128.8008">Pool User</text><ellipse cx="256.5" cy="63.7656" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M256.5,71.7656 L256.5,98.7656 M243.5,79.7656 L269.5,79.7656 M256.5,98.7656 L243.5,113.7656 M256.5,98.7656 L269.5,113.7656 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="221" y="1326.4688">Pool User</text><ellipse cx="256.5" cy="1337.9219" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M256.5,1345.9219 L256.5,1372.9219 M243.5,1353.9219 L269.5,1353.9219 M256.5,1372.9219 L243.5,1387.9219 M256.5,1372.9219 L269.5,1387.9219 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="650" y="128.8008">MPAS Contract</text><path d="M685.5,79.2656 C685.5,69.2656 703.5,69.2656 703.5,69.2656 C703.5,69.2656 721.5,69.2656 721.5,79.2656 L721.5,105.2656 C721.5,115.2656 703.5,115.2656 703.5,115.2656 C703.5,115.2656 685.5,115.2656 685.5,105.2656 L685.5,79.2656 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M685.5,79.2656 C685.5,89.2656 703.5,89.2656 703.5,89.2656 C703.5,89.2656 721.5,89.2656 721.5,79.2656 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="650" y="1326.4688">MPAS Contract</text><path d="M685.5,1339.4219 C685.5,1329.4219 703.5,1329.4219 703.5,1329.4219 C703.5,1329.4219 721.5,1329.4219 721.5,1339.4219 L721.5,1365.4219 C721.5,1375.4219 703.5,1375.4219 703.5,1375.4219 C703.5,1375.4219 685.5,1375.4219 685.5,1365.4219 L685.5,1339.4219 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M685.5,1339.4219 C685.5,1349.4219 703.5,1349.4219 703.5,1349.4219 C703.5,1349.4219 721.5,1349.4219 721.5,1339.4219 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="767.5" y="128.8008">Zoe</text><ellipse cx="783" cy="99.2656" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="771" x2="795" y1="113.2656" y2="113.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="767.5" y="1326.4688">Zoe</text><ellipse cx="783" cy="1345.4219" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="771" x2="795" y1="1359.4219" y2="1359.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1003.5" y="128.8008">userSeat</text><ellipse cx="1036" cy="99.2656" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1024" x2="1048" y1="113.2656" y2="113.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1003.5" y="1326.4688">userSeat</text><ellipse cx="1036" cy="1345.4219" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1024" x2="1048" y1="1359.4219" y2="1359.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="1078.5" y="128.8008">Pool SML:BUCK</text><path d="M1114.5,79.2656 C1114.5,69.2656 1132.5,69.2656 1132.5,69.2656 C1132.5,69.2656 1150.5,69.2656 1150.5,79.2656 L1150.5,105.2656 C1150.5,115.2656 1132.5,115.2656 1132.5,115.2656 C1132.5,115.2656 1114.5,115.2656 1114.5,105.2656 L1114.5,79.2656 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1114.5,79.2656 C1114.5,89.2656 1132.5,89.2656 1132.5,89.2656 C1132.5,89.2656 1150.5,89.2656 1150.5,79.2656 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="1078.5" y="1326.4688">Pool SML:BUCK</text><path d="M1114.5,1339.4219 C1114.5,1329.4219 1132.5,1329.4219 1132.5,1329.4219 C1132.5,1329.4219 1150.5,1329.4219 1150.5,1339.4219 L1150.5,1365.4219 C1150.5,1375.4219 1132.5,1375.4219 1132.5,1375.4219 C1132.5,1375.4219 1114.5,1375.4219 1114.5,1365.4219 L1114.5,1339.4219 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1114.5,1339.4219 C1114.5,1349.4219 1132.5,1349.4219 1132.5,1349.4219 C1132.5,1349.4219 1150.5,1349.4219 1150.5,1339.4219 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="1224.5" y="128.8008">poolSeat SML:BUCK</text><ellipse cx="1293.5" cy="99.2656" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1281.5" x2="1305.5" y1="113.2656" y2="113.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="1224.5" y="1326.4688">poolSeat SML:BUCK</text><ellipse cx="1293.5" cy="1345.4219" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1281.5" x2="1305.5" y1="1359.4219" y2="1359.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1372.5" y="128.8008">Pool MOOL:BUCK</text><path d="M1415.5,79.2656 C1415.5,69.2656 1433.5,69.2656 1433.5,69.2656 C1433.5,69.2656 1451.5,69.2656 1451.5,79.2656 L1451.5,105.2656 C1451.5,115.2656 1433.5,115.2656 1433.5,115.2656 C1433.5,115.2656 1415.5,115.2656 1415.5,105.2656 L1415.5,79.2656 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1415.5,79.2656 C1415.5,89.2656 1433.5,89.2656 1433.5,89.2656 C1433.5,89.2656 1451.5,89.2656 1451.5,79.2656 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1372.5" y="1326.4688">Pool MOOL:BUCK</text><path d="M1415.5,1339.4219 C1415.5,1329.4219 1433.5,1329.4219 1433.5,1329.4219 C1433.5,1329.4219 1451.5,1329.4219 1451.5,1339.4219 L1451.5,1365.4219 C1451.5,1375.4219 1433.5,1375.4219 1433.5,1375.4219 C1433.5,1375.4219 1415.5,1375.4219 1415.5,1365.4219 L1415.5,1339.4219 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1415.5,1339.4219 C1415.5,1349.4219 1433.5,1349.4219 1433.5,1349.4219 C1433.5,1349.4219 1451.5,1349.4219 1451.5,1339.4219 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="0" x2="1514.5" y1="142.7539" y2="142.7539"/><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1514.5" x="0" y="164.4092"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1514.5" y1="164.4092" y2="164.4092"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1514.5" y1="167.4092" y2="167.4092"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="112" x="701.25" y="153.7539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="94" x="707.25" y="170.3223">Swap Request</text><path d="M211,194.0645 L514,194.0645 L514,201.375 L504,211.375 L211,211.375 L211,194.0645 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:1.5;" width="556" x="211" y="194.0645"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="258" x="226" y="207.6328">asking for the current price UNK:BUCK</text><polygon fill="#181818" points="691.5,228.6855,701.5,232.6855,691.5,236.6855,695.5,232.6855" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="697.5" y1="232.6855" y2="232.6855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="263.5" y="227.9434">50</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="192" x="285.5" y="227.5308">getOutputPrice(UNK:BUCK)</text><line style="stroke:#181818;stroke-width:2.0;" x1="262.5" x2="272.5" y1="256.9961" y2="266.9961"/><line style="stroke:#181818;stroke-width:2.0;" x1="262.5" x2="272.5" y1="266.9961" y2="256.9961"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="268.5" x2="702.5" y1="261.9961" y2="261.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="273.5" y="257.2539">51</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="295.5" y="256.8413">brands were not recognized</text><path d="M211,283.9961 L527,283.9961 L527,291.3066 L517,301.3066 L211,301.3066 L211,283.9961 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="134.5527" style="stroke:#000000;stroke-width:1.5;" width="1293.5" x="211" y="283.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="271" x="226" y="297.5645">asking for the current price MOOL:BUCK</text><polygon fill="#181818" points="691.5,318.6172,701.5,322.6172,691.5,326.6172,695.5,322.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="697.5" y1="322.6172" y2="322.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="263.5" y="317.875">52</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="200" x="285.5" y="317.4624">getOutputPrice(MOOL:BUCK)</text><polygon fill="#181818" points="1421.5,347.9277,1431.5,351.9277,1421.5,355.9277,1425.5,351.9277" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="703.5" x2="1427.5" y1="351.9277" y2="351.9277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="710.5" y="347.1855">53</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="304" x="732.5" y="346.7729">getPriceGivenRequiredOutput(MOOL:BUCK)</text><polygon fill="#181818" points="714.5,377.2383,704.5,381.2383,714.5,385.2383,710.5,381.2383" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="708.5" x2="1432.5" y1="381.2383" y2="381.2383"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="720.5" y="376.4961">54</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="40" x="742.5" y="376.0835">quote</text><polygon fill="#181818" points="267.5,406.5488,257.5,410.5488,267.5,414.5488,263.5,410.5488" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="702.5" y1="410.5488" y2="410.5488"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="273.5" y="405.8066">55</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="40" x="295.5" y="405.394">quote</text><path d="M211,432.5488 L382,432.5488 L382,439.8594 L372,449.8594 L211,449.8594 L211,432.5488 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="59.6211" style="stroke:#000000;stroke-width:1.5;" width="357.5" x="211" y="432.5488"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126" x="226" y="446.1172">making a proposal</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="471.1699" y2="471.1699"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="471.1699" y2="484.1699"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="484.1699" y2="484.1699"/><polygon fill="#181818" points="267.5,480.1699,257.5,484.1699,267.5,488.1699,263.5,484.1699" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="263.5" y="466.4277">56</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="285.5" y="466.4277">create proposal for SML:BUCK as</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="492.5" y="466.104">proposal</text><path d="M211,506.1699 L518,506.1699 L518,513.4805 L508,523.4805 L211,523.4805 L211,506.1699 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:1.5;" width="556" x="211" y="506.1699"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="262" x="226" y="519.7383">requesting an invitation for a SwapOut</text><polygon fill="#181818" points="691.5,540.791,701.5,544.791,691.5,548.791,695.5,544.791" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="697.5" y1="544.791" y2="544.791"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="263.5" y="540.0488">57</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="184" x="285.5" y="539.6362">makeSwapOutInvitation()</text><polygon fill="#181818" points="267.5,570.1016,257.5,574.1016,267.5,578.1016,263.5,574.1016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="702.5" y1="574.1016" y2="574.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="273.5" y="569.3594">58</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="80" x="295.5" y="568.9468">invitation</text><path d="M211,596.1016 L364,596.1016 L364,603.4121 L354,613.4121 L211,613.4121 L211,596.1016 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="466.6582" style="stroke:#000000;stroke-width:1.5;" width="1161.5" x="211" y="596.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="108" x="226" y="609.6699">making an offer</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="634.7227" y2="634.7227"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="634.7227" y2="647.7227"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="647.7227" y2="647.7227"/><polygon fill="#181818" points="267.5,643.7227,257.5,647.7227,267.5,651.7227,263.5,647.7227" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="263.5" y="629.9805">59</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="285.5" y="629.9805">withdraw funds from purse of SML into</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="534.5" y="629.6567">payment</text><polygon fill="#181818" points="771,673.0332,781,677.0332,771,681.0332,775,677.0332" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="777" y1="677.0332" y2="677.0332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="263.5" y="672.291">60</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="296" x="285.5" y="671.8784">offer(invitation, proposal, payment))</text><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="825" y1="706.3438" y2="706.3438"/><line style="stroke:#181818;stroke-width:1.0;" x1="825" x2="825" y1="706.3438" y2="719.3438"/><line style="stroke:#181818;stroke-width:1.0;" x1="784" x2="825" y1="719.3438" y2="719.3438"/><polygon fill="#181818" points="794,715.3438,784,719.3438,794,723.3438,790,719.3438" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="790" y="701.6016">61</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="812" y="701.6016">validate offer</text><polygon fill="#181818" points="1024,744.6543,1034,748.6543,1024,752.6543,1028,748.6543" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="1030" y1="748.6543" y2="748.6543"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="790" y="743.9121">62</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="812" y="743.9121">create</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="854" y="743.5884">userSeat</text><polygon fill="#181818" points="794,773.9648,784,777.9648,794,781.9648,790,777.9648" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="788" x2="1035" y1="777.9648" y2="777.9648"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="800" y="773.2227">63</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="822" y="772.8101">userSeat</text><polygon fill="#181818" points="1120.5,803.2754,1130.5,807.2754,1120.5,811.2754,1124.5,807.2754" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="1126.5" y1="807.2754" y2="807.2754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="790" y="802.5332">64</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="812" y="802.1206">getPoolSeat()</text><polygon fill="#181818" points="1281.5,832.5859,1291.5,836.5859,1281.5,840.5859,1285.5,836.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1132.5" x2="1287.5" y1="836.5859" y2="836.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1139.5" y="831.8438">65</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="1161.5" y="831.8438">create</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="1203.5" y="831.52">poolSeat</text><polygon fill="#181818" points="794,861.8965,784,865.8965,794,869.8965,790,865.8965" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="788" x2="1292.5" y1="865.8965" y2="865.8965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="800" y="861.1543">66</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="822" y="860.7417">poolSeat</text><polygon fill="#181818" points="1281.5,891.207,1291.5,895.207,1281.5,899.207,1285.5,895.207" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="703.5" x2="1287.5" y1="895.207" y2="895.207"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="710.5" y="890.4648">67</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="732.5" y="890.4648">stage assets</text><polygon fill="#181818" points="1024,920.5176,1034,924.5176,1024,928.5176,1028,924.5176" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="703.5" x2="1030" y1="924.5176" y2="924.5176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="710.5" y="919.7754">68</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="732.5" y="919.7754">stage assets</text><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="825" y1="953.8281" y2="953.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="825" x2="825" y1="953.8281" y2="966.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="784" x2="825" y1="966.8281" y2="966.8281"/><polygon fill="#181818" points="794,962.8281,784,966.8281,794,970.8281,790,966.8281" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="790" y="949.0859">69</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="812" y="948.6733">reallocate(seat, poolSeat)</text><polygon fill="#181818" points="267.5,992.1387,257.5,996.1387,267.5,1000.1387,263.5,996.1387" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1035" y1="996.1387" y2="996.1387"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="273.5" y="991.3965">70</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="295.5" y="990.9839">userSeat</text><polygon fill="#181818" points="771,1021.4492,781,1025.4492,771,1029.4492,775,1025.4492" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="777" y1="1025.4492" y2="1025.4492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="263.5" y="1020.707">71</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="285.5" y="1020.2944">getOfferResult()</text><polygon fill="#181818" points="267.5,1050.7598,257.5,1054.7598,267.5,1058.7598,263.5,1054.7598" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="782" y1="1054.7598" y2="1054.7598"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="273.5" y="1050.0176">72</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="295.5" y="1050.0176">result of failure or success</text><path d="M211,1076.7598 L372,1076.7598 L372,1084.0703 L362,1094.0703 L211,1094.0703 L211,1076.7598 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="219.1738" style="stroke:#000000;stroke-width:1.5;" width="867.5" x="211" y="1076.7598"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="116" x="226" y="1090.3281">recovering funds</text><polygon fill="#181818" points="1024,1111.3809,1034,1115.3809,1024,1119.3809,1028,1115.3809" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="1030" y1="1115.3809" y2="1115.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="263.5" y="1110.6387">73</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="285.5" y="1110.3149">getPayout("Central")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="449.5" y="1110.6387">(give)</text><polygon fill="#181818" points="267.5,1140.6914,257.5,1144.6914,267.5,1148.6914,263.5,1144.6914" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1035" y1="1144.6914" y2="1144.6914"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="273.5" y="1139.9492">74</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="295.5" y="1139.5366">payoutCentral</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="1174.002" y2="1174.002"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="1174.002" y2="1187.002"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="1187.002" y2="1187.002"/><polygon fill="#181818" points="267.5,1183.002,257.5,1187.002,267.5,1191.002,263.5,1187.002" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="263.5" y="1169.2598">75</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="285.5" y="1169.2598">deposit</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="336.5" y="1168.936">payoutCentral</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="444.5" y="1169.2598">into purse</text><polygon fill="#181818" points="1024,1212.3125,1034,1216.3125,1024,1220.3125,1028,1216.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="1030" y1="1216.3125" y2="1216.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="263.5" y="1211.5703">76</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="285.5" y="1211.2466">getPayout("Secondary")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="465.5" y="1211.5703">(want)</text><polygon fill="#181818" points="267.5,1241.623,257.5,1245.623,267.5,1249.623,263.5,1245.623" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1035" y1="1245.623" y2="1245.623"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="273.5" y="1240.8809">77</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="295.5" y="1240.4683">payoutSecondary</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="1274.9336" y2="1274.9336"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="1274.9336" y2="1287.9336"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="1287.9336" y2="1287.9336"/><polygon fill="#181818" points="267.5,1283.9336,257.5,1287.9336,267.5,1291.9336,263.5,1287.9336" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="263.5" y="1270.1914">78</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="285.5" y="1270.1914">deposit</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="336.5" y="1269.8677">payoutSecondary</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="460.5" y="1270.1914">into purse</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="0" x2="1514.5" y1="1302.9336" y2="1302.9336"/><rect height="11.7773" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="176" x="1337.5" y="5"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="176" x="1337.5" y="14.668">Agoric Systems Operating Company.</text><rect height="11.7773" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="55" x="729.25" y="1394.4219"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="55" x="729.25" y="1404.0898">Page 2 of 4</text><!--MD5=[2d5f5151fc66bc58df860485dc589436]
@startuml
'https://plantuml.com/sequence-diagram
header Agoric Systems Operating Company.
footer Page %page% of %lastpage%
title Multipool Auto Swap Sequence Diagram Creation

autonumber
actor "MPAS Creator" as masc #lime
actor "Pool Adder N" as pa #yellow
actor "Pool User" as pu
database "MPAS Contract" as mpas
box "Zoe"
entity "Zoe" as zoe
entity "userSeat" as usA
end box

== MPAS Creation ==
masc -> mpas: Create instance
return ""creatorFacet""
== Pool Addition SML:BCK==
autonumber 10
pa -> mpas: ""addPool()""
database "Pool SML:BUCK" as pool
entity "poolSeat SML:BUCK" as psA

mpas -> pool: Create pool for SML -> BUCK
mpas - -> pa: ""Issuer""
== Pool Addition MOOL:BCK==
autonumber 10
pa -> mpas: ""addPool()""
database "Pool MOOL:BUCK" as pool2
mpas -> pool2: Create pool for MOOL -> BUCK
mpas - -> pa: ""Issuer""


== Duplicate Pool Addition MOOL:BCK==
autonumber 30
pa -> mpas: ""addPool()""
mpas - ->x pa: pool for MOOL:BCK already exists
newpage Multipool Auto Swap Sequence Diagram Swap Request

autonumber 50
== Swap Request ==
group asking for the current price UNK:BUCK
pu -> mpas: ""getOutputPrice(UNK:BUCK)""
mpas - ->x pu: ""brands were not recognized""
end
group asking for the current price MOOL:BUCK


pu -> mpas: ""getOutputPrice(MOOL:BUCK)""
mpas -> pool2: ""getPriceGivenRequiredOutput(MOOL:BUCK)""
pool2 - -> mpas: ""quote""
mpas - -> pu: ""quote""
end

group making a proposal
pu -> pu: create proposal for SML:BUCK as ""proposal""

end

group requesting an invitation for a SwapOut
pu -> mpas: ""makeSwapOutInvitation()""
return ""invitation""

end

group making an offer
pu -> pu: withdraw funds from purse of SML into ""payment""
pu -> zoe: ""offer(invitation, proposal, payment))""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

newpage Multipool Auto Swap Sequence Diagram Adding Liquidity

autonumber 100
== Adding Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> mpas: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to add 1 BUCK, and 1 SML\nat ratio of ""poolAllocation"" for X ""liquidity""
end
group withdraw funds
pu -> pu: withdraw funds for ""BUCK"" into ""payments"" record
pu -> pu: withdraw funds for ""SML"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (give)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
pu -> usA: ""getPayout("Liquidity")"" (want)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
end


newpage Multipool Auto Swap Sequence Diagram Removing Liquidity

autonumber 200
== Removing Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> mpas: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to remove 1 ""liquidity"" for 1 BUCK and 1 SML\nat ratio of ""poolAllocation""
end
group withdraw funds
pu -> pu: withdraw funds for ""liquidity"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Liquidity")"" (give)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
pu -> usA: ""getPayout("Central")"" (want)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

@enduml

@startuml
header Agoric Systems Operating Company.
footer Page %page% of %lastpage%
title Multipool Auto Swap Sequence Diagram Creation

autonumber
actor "MPAS Creator" as masc #lime
actor "Pool Adder N" as pa #yellow
actor "Pool User" as pu
database "MPAS Contract" as mpas
box "Zoe"
entity "Zoe" as zoe
entity "userSeat" as usA
end box

== MPAS Creation ==
masc -> mpas: Create instance
return ""creatorFacet""
== Pool Addition SML:BCK==
autonumber 10
pa -> mpas: ""addPool()""
database "Pool SML:BUCK" as pool
entity "poolSeat SML:BUCK" as psA

mpas -> pool: Create pool for SML -> BUCK
mpas - -> pa: ""Issuer""
== Pool Addition MOOL:BCK==
autonumber 10
pa -> mpas: ""addPool()""
database "Pool MOOL:BUCK" as pool2
mpas -> pool2: Create pool for MOOL -> BUCK
mpas - -> pa: ""Issuer""


== Duplicate Pool Addition MOOL:BCK==
autonumber 30
pa -> mpas: ""addPool()""
mpas - ->x pa: pool for MOOL:BCK already exists
newpage Multipool Auto Swap Sequence Diagram Swap Request

autonumber 50
== Swap Request ==
group asking for the current price UNK:BUCK
pu -> mpas: ""getOutputPrice(UNK:BUCK)""
mpas - ->x pu: ""brands were not recognized""
end
group asking for the current price MOOL:BUCK


pu -> mpas: ""getOutputPrice(MOOL:BUCK)""
mpas -> pool2: ""getPriceGivenRequiredOutput(MOOL:BUCK)""
pool2 - -> mpas: ""quote""
mpas - -> pu: ""quote""
end

group making a proposal
pu -> pu: create proposal for SML:BUCK as ""proposal""

end

group requesting an invitation for a SwapOut
pu -> mpas: ""makeSwapOutInvitation()""
return ""invitation""

end

group making an offer
pu -> pu: withdraw funds from purse of SML into ""payment""
pu -> zoe: ""offer(invitation, proposal, payment))""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

newpage Multipool Auto Swap Sequence Diagram Adding Liquidity

autonumber 100
== Adding Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> mpas: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to add 1 BUCK, and 1 SML\nat ratio of ""poolAllocation"" for X ""liquidity""
end
group withdraw funds
pu -> pu: withdraw funds for ""BUCK"" into ""payments"" record
pu -> pu: withdraw funds for ""SML"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (give)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
pu -> usA: ""getPayout("Liquidity")"" (want)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
end


newpage Multipool Auto Swap Sequence Diagram Removing Liquidity

autonumber 200
== Removing Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> mpas: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to remove 1 ""liquidity"" for 1 BUCK and 1 SML\nat ratio of ""poolAllocation""
end
group withdraw funds
pu -> pu: withdraw funds for ""liquidity"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Liquidity")"" (give)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
pu -> usA: ""getPayout("Central")"" (want)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

@enduml

PlantUML version 1.2022.2(Sat Mar 05 08:30:19 PST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>