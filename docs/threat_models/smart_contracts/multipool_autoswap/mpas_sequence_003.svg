<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1410px" preserveAspectRatio="none" style="width:1521px;height:1410px;background:#FFFFFF;" version="1.1" viewBox="0 0 1521 1410" width="1521px" zoomAndPan="magnify"><defs/><g><rect height="26.4883" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="444" x="534.75" y="22.7773"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="434" x="539.75" y="41.3125">Multipool Auto Swap Sequence Diagram Removing Liquidity</text><rect fill="#DDDDDD" height="1333.1563" style="stroke:#181818;stroke-width:0.5;" width="309.5" x="763" y="56.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="905.75" y="68.834">Zoe</text><rect height="75.9316" style="stroke:#000000;stroke-width:1.5;fill:none;" width="985.5" x="211" y="194.0645"/><rect height="75.9316" style="stroke:#000000;stroke-width:1.5;fill:none;" width="556" x="211" y="283.9961"/><rect height="74.9316" style="stroke:#000000;stroke-width:1.5;fill:none;" width="497.5" x="211" y="373.9277"/><rect height="495.9688" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1161.5" x="211" y="462.8594"/><rect height="320.1055" style="stroke:#000000;stroke-width:1.5;fill:none;" width="867.5" x="211" y="972.8281"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="55" x2="55" y1="131.7539" y2="1309.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="163" x2="163" y1="131.7539" y2="1309.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="256" x2="256" y1="131.7539" y2="1309.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="703" x2="703" y1="131.7539" y2="1309.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="783" x2="783" y1="131.7539" y2="1309.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1035.5" x2="1035.5" y1="131.7539" y2="1309.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1132.5" x2="1132.5" y1="131.7539" y2="1309.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1293.5" x2="1293.5" y1="131.7539" y2="1309.9336"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1433.5" x2="1433.5" y1="131.7539" y2="1309.9336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="5" y="128.8008">MPAS Creator</text><ellipse cx="55" cy="63.7656" fill="#00FF00" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M55,71.7656 L55,98.7656 M42,79.7656 L68,79.7656 M55,98.7656 L42,113.7656 M55,98.7656 L68,113.7656 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="5" y="1322.4688">MPAS Creator</text><ellipse cx="55" cy="1333.9219" fill="#00FF00" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M55,1341.9219 L55,1368.9219 M42,1349.9219 L68,1349.9219 M55,1368.9219 L42,1383.9219 M55,1368.9219 L68,1383.9219 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="115" y="128.8008">Pool Adder N</text><ellipse cx="163" cy="63.7656" fill="#FFFF00" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M163,71.7656 L163,98.7656 M150,79.7656 L176,79.7656 M163,98.7656 L150,113.7656 M163,98.7656 L176,113.7656 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="115" y="1322.4688">Pool Adder N</text><ellipse cx="163" cy="1333.9219" fill="#FFFF00" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M163,1341.9219 L163,1368.9219 M150,1349.9219 L176,1349.9219 M163,1368.9219 L150,1383.9219 M163,1368.9219 L176,1383.9219 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="221" y="128.8008">Pool User</text><ellipse cx="256.5" cy="63.7656" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M256.5,71.7656 L256.5,98.7656 M243.5,79.7656 L269.5,79.7656 M256.5,98.7656 L243.5,113.7656 M256.5,98.7656 L269.5,113.7656 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="221" y="1322.4688">Pool User</text><ellipse cx="256.5" cy="1333.9219" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M256.5,1341.9219 L256.5,1368.9219 M243.5,1349.9219 L269.5,1349.9219 M256.5,1368.9219 L243.5,1383.9219 M256.5,1368.9219 L269.5,1383.9219 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="650" y="128.8008">MPAS Contract</text><path d="M685.5,79.2656 C685.5,69.2656 703.5,69.2656 703.5,69.2656 C703.5,69.2656 721.5,69.2656 721.5,79.2656 L721.5,105.2656 C721.5,115.2656 703.5,115.2656 703.5,115.2656 C703.5,115.2656 685.5,115.2656 685.5,105.2656 L685.5,79.2656 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M685.5,79.2656 C685.5,89.2656 703.5,89.2656 703.5,89.2656 C703.5,89.2656 721.5,89.2656 721.5,79.2656 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="650" y="1322.4688">MPAS Contract</text><path d="M685.5,1335.4219 C685.5,1325.4219 703.5,1325.4219 703.5,1325.4219 C703.5,1325.4219 721.5,1325.4219 721.5,1335.4219 L721.5,1361.4219 C721.5,1371.4219 703.5,1371.4219 703.5,1371.4219 C703.5,1371.4219 685.5,1371.4219 685.5,1361.4219 L685.5,1335.4219 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M685.5,1335.4219 C685.5,1345.4219 703.5,1345.4219 703.5,1345.4219 C703.5,1345.4219 721.5,1345.4219 721.5,1335.4219 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="767.5" y="128.8008">Zoe</text><ellipse cx="783" cy="99.2656" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="771" x2="795" y1="113.2656" y2="113.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="767.5" y="1322.4688">Zoe</text><ellipse cx="783" cy="1341.4219" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="771" x2="795" y1="1355.4219" y2="1355.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1003.5" y="128.8008">userSeat</text><ellipse cx="1036" cy="99.2656" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1024" x2="1048" y1="113.2656" y2="113.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1003.5" y="1322.4688">userSeat</text><ellipse cx="1036" cy="1341.4219" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1024" x2="1048" y1="1355.4219" y2="1355.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="1078.5" y="128.8008">Pool SML:BUCK</text><path d="M1114.5,79.2656 C1114.5,69.2656 1132.5,69.2656 1132.5,69.2656 C1132.5,69.2656 1150.5,69.2656 1150.5,79.2656 L1150.5,105.2656 C1150.5,115.2656 1132.5,115.2656 1132.5,115.2656 C1132.5,115.2656 1114.5,115.2656 1114.5,105.2656 L1114.5,79.2656 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1114.5,79.2656 C1114.5,89.2656 1132.5,89.2656 1132.5,89.2656 C1132.5,89.2656 1150.5,89.2656 1150.5,79.2656 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="1078.5" y="1322.4688">Pool SML:BUCK</text><path d="M1114.5,1335.4219 C1114.5,1325.4219 1132.5,1325.4219 1132.5,1325.4219 C1132.5,1325.4219 1150.5,1325.4219 1150.5,1335.4219 L1150.5,1361.4219 C1150.5,1371.4219 1132.5,1371.4219 1132.5,1371.4219 C1132.5,1371.4219 1114.5,1371.4219 1114.5,1361.4219 L1114.5,1335.4219 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1114.5,1335.4219 C1114.5,1345.4219 1132.5,1345.4219 1132.5,1345.4219 C1132.5,1345.4219 1150.5,1345.4219 1150.5,1335.4219 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="1224.5" y="128.8008">poolSeat SML:BUCK</text><ellipse cx="1293.5" cy="99.2656" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1281.5" x2="1305.5" y1="113.2656" y2="113.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="1224.5" y="1322.4688">poolSeat SML:BUCK</text><ellipse cx="1293.5" cy="1341.4219" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1281.5" x2="1305.5" y1="1355.4219" y2="1355.4219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1372.5" y="128.8008">Pool MOOL:BUCK</text><path d="M1415.5,79.2656 C1415.5,69.2656 1433.5,69.2656 1433.5,69.2656 C1433.5,69.2656 1451.5,69.2656 1451.5,79.2656 L1451.5,105.2656 C1451.5,115.2656 1433.5,115.2656 1433.5,115.2656 C1433.5,115.2656 1415.5,115.2656 1415.5,105.2656 L1415.5,79.2656 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1415.5,79.2656 C1415.5,89.2656 1433.5,89.2656 1433.5,89.2656 C1433.5,89.2656 1451.5,89.2656 1451.5,79.2656 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1372.5" y="1322.4688">Pool MOOL:BUCK</text><path d="M1415.5,1335.4219 C1415.5,1325.4219 1433.5,1325.4219 1433.5,1325.4219 C1433.5,1325.4219 1451.5,1325.4219 1451.5,1335.4219 L1451.5,1361.4219 C1451.5,1371.4219 1433.5,1371.4219 1433.5,1371.4219 C1433.5,1371.4219 1415.5,1371.4219 1415.5,1361.4219 L1415.5,1335.4219 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1415.5,1335.4219 C1415.5,1345.4219 1433.5,1345.4219 1433.5,1345.4219 C1433.5,1345.4219 1451.5,1345.4219 1451.5,1335.4219 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="0" x2="1514.5" y1="142.7539" y2="142.7539"/><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1514.5" x="0" y="164.4092"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1514.5" y1="164.4092" y2="164.4092"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1514.5" y1="167.4092" y2="167.4092"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="150" x="682.25" y="153.7539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="132" x="688.25" y="170.3223">Removing Liquidity</text><path d="M211,194.0645 L528,194.0645 L528,201.375 L518,211.375 L211,211.375 L211,194.0645 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:1.5;" width="985.5" x="211" y="194.0645"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="272" x="226" y="207.6328">discover existing proportion of balances</text><polygon fill="#181818" points="1120.5,228.6855,1130.5,232.6855,1120.5,236.6855,1124.5,232.6855" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="1126.5" y1="232.6855" y2="232.6855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="227.9434">200</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="294.5" y="227.5308">getPoolAllocation(SML)</text><polygon fill="#181818" points="267.5,257.9961,257.5,261.9961,267.5,265.9961,263.5,261.9961" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1131.5" y1="261.9961" y2="261.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="257.2539">201</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="304.5" y="256.8413">poolAllocation</text><path d="M211,283.9961 L340,283.9961 L340,291.3066 L330,301.3066 L211,301.3066 L211,283.9961 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:1.5;" width="556" x="211" y="283.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="84" x="226" y="297.5645">create invite</text><polygon fill="#181818" points="691.5,318.6172,701.5,322.6172,691.5,326.6172,695.5,322.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="697.5" y1="322.6172" y2="322.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="317.875">202</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="294.5" y="317.4624">makeAddLiquidityInvitation</text><polygon fill="#181818" points="267.5,347.9277,257.5,351.9277,267.5,355.9277,263.5,351.9277" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="702.5" y1="351.9277" y2="351.9277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="347.1855">203</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="80" x="304.5" y="346.7729">invitation</text><path d="M211,373.9277 L361,373.9277 L361,381.2383 L351,391.2383 L211,391.2383 L211,373.9277 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="74.9316" style="stroke:#000000;stroke-width:1.5;" width="497.5" x="211" y="373.9277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="105" x="226" y="387.4961">create proposal</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="427.8594" y2="427.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="427.8594" y2="440.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="440.8594" y2="440.8594"/><polygon fill="#181818" points="267.5,436.8594,257.5,440.8594,267.5,444.8594,263.5,440.8594" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="415.4619">204</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="294.5" y="407.8066">Create</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="338.5" y="407.4829">proposal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="406.5" y="407.8066">to remove 1</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="485.5" y="407.4829">liquidity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="561.5" y="407.8066">for 1 BUCK and 1 SML</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="294.5" y="423.1172">at ratio of</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="360.5" y="422.7935">poolAllocation</text><path d="M211,462.8594 L362,462.8594 L362,470.1699 L352,480.1699 L211,480.1699 L211,462.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="495.9688" style="stroke:#000000;stroke-width:1.5;" width="1161.5" x="211" y="462.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="226" y="476.4277">withdraw funds</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="501.4805" y2="501.4805"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="501.4805" y2="514.4805"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="514.4805" y2="514.4805"/><polygon fill="#181818" points="267.5,510.4805,257.5,514.4805,267.5,518.4805,263.5,514.4805" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="496.7383">205</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="294.5" y="496.7383">withdraw funds for</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="417.5" y="496.4146">liquidity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25" x="493.5" y="496.7383">into</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="522.5" y="496.4146">payments</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="590.5" y="496.7383">record</text><polygon fill="#181818" points="771,539.791,781,543.791,771,547.791,775,543.791" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="777" y1="543.791" y2="543.791"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="539.0488">206</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="296" x="294.5" y="538.6362">offer(invitation, proposal, payments)</text><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="825" y1="573.1016" y2="573.1016"/><line style="stroke:#181818;stroke-width:1.0;" x1="825" x2="825" y1="573.1016" y2="586.1016"/><line style="stroke:#181818;stroke-width:1.0;" x1="784" x2="825" y1="586.1016" y2="586.1016"/><polygon fill="#181818" points="794,582.1016,784,586.1016,794,590.1016,790,586.1016" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="790" y="568.3594">207</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="821" y="568.3594">validate offer</text><polygon fill="#181818" points="1024,611.4121,1034,615.4121,1024,619.4121,1028,615.4121" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="1030" y1="615.4121" y2="615.4121"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="790" y="610.6699">208</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="821" y="610.6699">create</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="863" y="610.3462">userSeat</text><polygon fill="#181818" points="794,640.7227,784,644.7227,794,648.7227,790,644.7227" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="788" x2="1035" y1="644.7227" y2="644.7227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="800" y="639.9805">209</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="831" y="639.5679">userSeat</text><polygon fill="#181818" points="1120.5,670.0332,1130.5,674.0332,1120.5,678.0332,1124.5,674.0332" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="1126.5" y1="674.0332" y2="674.0332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="790" y="669.291">210</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="821" y="668.8784">getPoolSeat()</text><polygon fill="#181818" points="1281.5,699.3438,1291.5,703.3438,1281.5,707.3438,1285.5,703.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1132.5" x2="1287.5" y1="703.3438" y2="703.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="1139.5" y="698.6016">211</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="1170.5" y="698.6016">create</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="1212.5" y="698.2778">poolSeat</text><polygon fill="#181818" points="794,728.6543,784,732.6543,794,736.6543,790,732.6543" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="788" x2="1292.5" y1="732.6543" y2="732.6543"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="800" y="727.9121">212</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="831" y="727.4995">poolSeat</text><polygon fill="#181818" points="1281.5,757.9648,1291.5,761.9648,1281.5,765.9648,1285.5,761.9648" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="1287.5" y1="761.9648" y2="761.9648"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="790" y="757.2227">213</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="821" y="756.8101">addLiquidity</text><polygon fill="#181818" points="1281.5,787.2754,1291.5,791.2754,1281.5,795.2754,1285.5,791.2754" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="703.5" x2="1287.5" y1="791.2754" y2="791.2754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="710.5" y="786.5332">214</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="741.5" y="786.5332">stage assets</text><polygon fill="#181818" points="1024,816.5859,1034,820.5859,1024,824.5859,1028,820.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="703.5" x2="1030" y1="820.5859" y2="820.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="710.5" y="815.8438">215</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="741.5" y="815.8438">stage assets</text><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="825" y1="849.8965" y2="849.8965"/><line style="stroke:#181818;stroke-width:1.0;" x1="825" x2="825" y1="849.8965" y2="862.8965"/><line style="stroke:#181818;stroke-width:1.0;" x1="784" x2="825" y1="862.8965" y2="862.8965"/><polygon fill="#181818" points="794,858.8965,784,862.8965,794,866.8965,790,862.8965" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="790" y="845.1543">216</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="821" y="844.7417">reallocate(seat, poolSeat)</text><polygon fill="#181818" points="267.5,888.207,257.5,892.207,267.5,896.207,263.5,892.207" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1035" y1="892.207" y2="892.207"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="887.4648">217</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="304.5" y="887.0522">userSeat</text><polygon fill="#181818" points="771,917.5176,781,921.5176,771,925.5176,775,921.5176" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="777" y1="921.5176" y2="921.5176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="916.7754">218</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="294.5" y="916.3628">getOfferResult()</text><polygon fill="#181818" points="267.5,946.8281,257.5,950.8281,267.5,954.8281,263.5,950.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="782" y1="950.8281" y2="950.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="946.0859">219</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="304.5" y="946.0859">result of failure or success</text><path d="M211,972.8281 L372,972.8281 L372,980.1387 L362,990.1387 L211,990.1387 L211,972.8281 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="320.1055" style="stroke:#000000;stroke-width:1.5;" width="867.5" x="211" y="972.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="116" x="226" y="986.3965">recovering funds</text><polygon fill="#181818" points="1024,1007.4492,1034,1011.4492,1024,1015.4492,1028,1011.4492" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="1030" y1="1011.4492" y2="1011.4492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="1006.707">220</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="294.5" y="1006.3833">getPayout("Liquidity")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="474.5" y="1006.707">(give)</text><polygon fill="#181818" points="267.5,1036.7598,257.5,1040.7598,267.5,1044.7598,263.5,1040.7598" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1035" y1="1040.7598" y2="1040.7598"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="1036.0176">221</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="304.5" y="1035.605">payoutLiquidity</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="1070.0703" y2="1070.0703"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="1070.0703" y2="1083.0703"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="1083.0703" y2="1083.0703"/><polygon fill="#181818" points="267.5,1079.0703,257.5,1083.0703,267.5,1087.0703,263.5,1083.0703" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="1065.3281">222</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="294.5" y="1065.3281">deposit</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="345.5" y="1065.0044">payoutLiquidity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="469.5" y="1065.3281">into purse</text><polygon fill="#181818" points="1024,1108.3809,1034,1112.3809,1024,1116.3809,1028,1112.3809" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="1030" y1="1112.3809" y2="1112.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="1107.6387">223</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="294.5" y="1107.3149">getPayout("Central")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="458.5" y="1107.6387">(want)</text><polygon fill="#181818" points="267.5,1137.6914,257.5,1141.6914,267.5,1145.6914,263.5,1141.6914" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1035" y1="1141.6914" y2="1141.6914"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="1136.9492">224</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="304.5" y="1136.5366">payoutCentral</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="1171.002" y2="1171.002"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="1171.002" y2="1184.002"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="1184.002" y2="1184.002"/><polygon fill="#181818" points="267.5,1180.002,257.5,1184.002,267.5,1188.002,263.5,1184.002" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="1166.2598">225</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="294.5" y="1166.2598">deposit</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="345.5" y="1165.936">payoutCentral</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="453.5" y="1166.2598">into purse</text><polygon fill="#181818" points="1024,1209.3125,1034,1213.3125,1024,1217.3125,1028,1213.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="1030" y1="1213.3125" y2="1213.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="1208.5703">226</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="294.5" y="1208.2466">getPayout("Secondary")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="474.5" y="1208.5703">(want)</text><polygon fill="#181818" points="267.5,1238.623,257.5,1242.623,267.5,1246.623,263.5,1242.623" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1035" y1="1242.623" y2="1242.623"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="1237.8809">227</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="304.5" y="1237.4683">payoutSecondary</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="1271.9336" y2="1271.9336"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="1271.9336" y2="1284.9336"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="1284.9336" y2="1284.9336"/><polygon fill="#181818" points="267.5,1280.9336,257.5,1284.9336,267.5,1288.9336,263.5,1284.9336" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="1267.1914">228</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="294.5" y="1267.1914">deposit</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="345.5" y="1266.8677">payoutSecondary</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="469.5" y="1267.1914">into purse</text><rect height="11.7773" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="176" x="1337.5" y="5"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="176" x="1337.5" y="14.668">Agoric Systems Operating Company.</text><rect height="11.7773" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="55" x="729.25" y="1390.4219"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="55" x="729.25" y="1400.0898">Page 4 of 4</text><!--MD5=[2d5f5151fc66bc58df860485dc589436]
@startuml
'https://plantuml.com/sequence-diagram
header Agoric Systems Operating Company.
footer Page %page% of %lastpage%
title Multipool Auto Swap Sequence Diagram Creation

autonumber
actor "MPAS Creator" as masc #lime
actor "Pool Adder N" as pa #yellow
actor "Pool User" as pu
database "MPAS Contract" as mpas
box "Zoe"
entity "Zoe" as zoe
entity "userSeat" as usA
end box

== MPAS Creation ==
masc -> mpas: Create instance
return ""creatorFacet""
== Pool Addition SML:BCK==
autonumber 10
pa -> mpas: ""addPool()""
database "Pool SML:BUCK" as pool
entity "poolSeat SML:BUCK" as psA

mpas -> pool: Create pool for SML -> BUCK
mpas - -> pa: ""Issuer""
== Pool Addition MOOL:BCK==
autonumber 10
pa -> mpas: ""addPool()""
database "Pool MOOL:BUCK" as pool2
mpas -> pool2: Create pool for MOOL -> BUCK
mpas - -> pa: ""Issuer""


== Duplicate Pool Addition MOOL:BCK==
autonumber 30
pa -> mpas: ""addPool()""
mpas - ->x pa: pool for MOOL:BCK already exists
newpage Multipool Auto Swap Sequence Diagram Swap Request

autonumber 50
== Swap Request ==
group asking for the current price UNK:BUCK
pu -> mpas: ""getOutputPrice(UNK:BUCK)""
mpas - ->x pu: ""brands were not recognized""
end
group asking for the current price MOOL:BUCK


pu -> mpas: ""getOutputPrice(MOOL:BUCK)""
mpas -> pool2: ""getPriceGivenRequiredOutput(MOOL:BUCK)""
pool2 - -> mpas: ""quote""
mpas - -> pu: ""quote""
end

group making a proposal
pu -> pu: create proposal for SML:BUCK as ""proposal""

end

group requesting an invitation for a SwapOut
pu -> mpas: ""makeSwapOutInvitation()""
return ""invitation""

end

group making an offer
pu -> pu: withdraw funds from purse of SML into ""payment""
pu -> zoe: ""offer(invitation, proposal, payment))""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

newpage Multipool Auto Swap Sequence Diagram Adding Liquidity

autonumber 100
== Adding Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> mpas: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to add 1 BUCK, and 1 SML\nat ratio of ""poolAllocation"" for X ""liquidity""
end
group withdraw funds
pu -> pu: withdraw funds for ""BUCK"" into ""payments"" record
pu -> pu: withdraw funds for ""SML"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (give)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
pu -> usA: ""getPayout("Liquidity")"" (want)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
end


newpage Multipool Auto Swap Sequence Diagram Removing Liquidity

autonumber 200
== Removing Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> mpas: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to remove 1 ""liquidity"" for 1 BUCK and 1 SML\nat ratio of ""poolAllocation""
end
group withdraw funds
pu -> pu: withdraw funds for ""liquidity"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Liquidity")"" (give)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
pu -> usA: ""getPayout("Central")"" (want)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

@enduml

@startuml
header Agoric Systems Operating Company.
footer Page %page% of %lastpage%
title Multipool Auto Swap Sequence Diagram Creation

autonumber
actor "MPAS Creator" as masc #lime
actor "Pool Adder N" as pa #yellow
actor "Pool User" as pu
database "MPAS Contract" as mpas
box "Zoe"
entity "Zoe" as zoe
entity "userSeat" as usA
end box

== MPAS Creation ==
masc -> mpas: Create instance
return ""creatorFacet""
== Pool Addition SML:BCK==
autonumber 10
pa -> mpas: ""addPool()""
database "Pool SML:BUCK" as pool
entity "poolSeat SML:BUCK" as psA

mpas -> pool: Create pool for SML -> BUCK
mpas - -> pa: ""Issuer""
== Pool Addition MOOL:BCK==
autonumber 10
pa -> mpas: ""addPool()""
database "Pool MOOL:BUCK" as pool2
mpas -> pool2: Create pool for MOOL -> BUCK
mpas - -> pa: ""Issuer""


== Duplicate Pool Addition MOOL:BCK==
autonumber 30
pa -> mpas: ""addPool()""
mpas - ->x pa: pool for MOOL:BCK already exists
newpage Multipool Auto Swap Sequence Diagram Swap Request

autonumber 50
== Swap Request ==
group asking for the current price UNK:BUCK
pu -> mpas: ""getOutputPrice(UNK:BUCK)""
mpas - ->x pu: ""brands were not recognized""
end
group asking for the current price MOOL:BUCK


pu -> mpas: ""getOutputPrice(MOOL:BUCK)""
mpas -> pool2: ""getPriceGivenRequiredOutput(MOOL:BUCK)""
pool2 - -> mpas: ""quote""
mpas - -> pu: ""quote""
end

group making a proposal
pu -> pu: create proposal for SML:BUCK as ""proposal""

end

group requesting an invitation for a SwapOut
pu -> mpas: ""makeSwapOutInvitation()""
return ""invitation""

end

group making an offer
pu -> pu: withdraw funds from purse of SML into ""payment""
pu -> zoe: ""offer(invitation, proposal, payment))""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

newpage Multipool Auto Swap Sequence Diagram Adding Liquidity

autonumber 100
== Adding Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> mpas: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to add 1 BUCK, and 1 SML\nat ratio of ""poolAllocation"" for X ""liquidity""
end
group withdraw funds
pu -> pu: withdraw funds for ""BUCK"" into ""payments"" record
pu -> pu: withdraw funds for ""SML"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (give)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
pu -> usA: ""getPayout("Liquidity")"" (want)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
end


newpage Multipool Auto Swap Sequence Diagram Removing Liquidity

autonumber 200
== Removing Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> mpas: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to remove 1 ""liquidity"" for 1 BUCK and 1 SML\nat ratio of ""poolAllocation""
end
group withdraw funds
pu -> pu: withdraw funds for ""liquidity"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Liquidity")"" (give)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
pu -> usA: ""getPayout("Central")"" (want)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

@enduml

PlantUML version 1.2022.2(Sat Mar 05 08:30:19 PST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>