<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1453px" preserveAspectRatio="none" style="width:1521px;height:1453px;background:#FFFFFF;" version="1.1" viewBox="0 0 1521 1453" width="1521px" zoomAndPan="magnify"><defs/><g><rect height="26.4883" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="423" x="545.25" y="22.7773"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="413" x="550.25" y="41.3125">Multipool Auto Swap Sequence Diagram Adding Liquidity</text><rect fill="#DDDDDD" height="1376.4668" style="stroke:#181818;stroke-width:0.5;" width="309.5" x="763" y="56.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="905.75" y="68.834">Zoe</text><rect height="75.9316" style="stroke:#000000;stroke-width:1.5;fill:none;" width="985.5" x="211" y="194.0645"/><rect height="75.9316" style="stroke:#000000;stroke-width:1.5;fill:none;" width="556" x="211" y="283.9961"/><rect height="74.9316" style="stroke:#000000;stroke-width:1.5;fill:none;" width="383.5" x="211" y="373.9277"/><rect height="538.2793" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1161.5" x="211" y="462.8594"/><rect height="320.1055" style="stroke:#000000;stroke-width:1.5;fill:none;" width="867.5" x="211" y="1015.1387"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="55" x2="55" y1="131.7539" y2="1353.2441"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="163" x2="163" y1="131.7539" y2="1353.2441"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="256" x2="256" y1="131.7539" y2="1353.2441"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="703" x2="703" y1="131.7539" y2="1353.2441"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="783" x2="783" y1="131.7539" y2="1353.2441"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1035.5" x2="1035.5" y1="131.7539" y2="1353.2441"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1132.5" x2="1132.5" y1="131.7539" y2="1353.2441"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1293.5" x2="1293.5" y1="131.7539" y2="1353.2441"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1433.5" x2="1433.5" y1="131.7539" y2="1353.2441"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="5" y="128.8008">MPAS Creator</text><ellipse cx="55" cy="63.7656" fill="#00FF00" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M55,71.7656 L55,98.7656 M42,79.7656 L68,79.7656 M55,98.7656 L42,113.7656 M55,98.7656 L68,113.7656 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="5" y="1365.7793">MPAS Creator</text><ellipse cx="55" cy="1377.2324" fill="#00FF00" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M55,1385.2324 L55,1412.2324 M42,1393.2324 L68,1393.2324 M55,1412.2324 L42,1427.2324 M55,1412.2324 L68,1427.2324 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="115" y="128.8008">Pool Adder N</text><ellipse cx="163" cy="63.7656" fill="#FFFF00" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M163,71.7656 L163,98.7656 M150,79.7656 L176,79.7656 M163,98.7656 L150,113.7656 M163,98.7656 L176,113.7656 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="115" y="1365.7793">Pool Adder N</text><ellipse cx="163" cy="1377.2324" fill="#FFFF00" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M163,1385.2324 L163,1412.2324 M150,1393.2324 L176,1393.2324 M163,1412.2324 L150,1427.2324 M163,1412.2324 L176,1427.2324 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="221" y="128.8008">Pool User</text><ellipse cx="256.5" cy="63.7656" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M256.5,71.7656 L256.5,98.7656 M243.5,79.7656 L269.5,79.7656 M256.5,98.7656 L243.5,113.7656 M256.5,98.7656 L269.5,113.7656 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="221" y="1365.7793">Pool User</text><ellipse cx="256.5" cy="1377.2324" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M256.5,1385.2324 L256.5,1412.2324 M243.5,1393.2324 L269.5,1393.2324 M256.5,1412.2324 L243.5,1427.2324 M256.5,1412.2324 L269.5,1427.2324 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="650" y="128.8008">MPAS Contract</text><path d="M685.5,79.2656 C685.5,69.2656 703.5,69.2656 703.5,69.2656 C703.5,69.2656 721.5,69.2656 721.5,79.2656 L721.5,105.2656 C721.5,115.2656 703.5,115.2656 703.5,115.2656 C703.5,115.2656 685.5,115.2656 685.5,105.2656 L685.5,79.2656 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M685.5,79.2656 C685.5,89.2656 703.5,89.2656 703.5,89.2656 C703.5,89.2656 721.5,89.2656 721.5,79.2656 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="650" y="1365.7793">MPAS Contract</text><path d="M685.5,1378.7324 C685.5,1368.7324 703.5,1368.7324 703.5,1368.7324 C703.5,1368.7324 721.5,1368.7324 721.5,1378.7324 L721.5,1404.7324 C721.5,1414.7324 703.5,1414.7324 703.5,1414.7324 C703.5,1414.7324 685.5,1414.7324 685.5,1404.7324 L685.5,1378.7324 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M685.5,1378.7324 C685.5,1388.7324 703.5,1388.7324 703.5,1388.7324 C703.5,1388.7324 721.5,1388.7324 721.5,1378.7324 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="767.5" y="128.8008">Zoe</text><ellipse cx="783" cy="99.2656" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="771" x2="795" y1="113.2656" y2="113.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="767.5" y="1365.7793">Zoe</text><ellipse cx="783" cy="1384.7324" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="771" x2="795" y1="1398.7324" y2="1398.7324"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1003.5" y="128.8008">userSeat</text><ellipse cx="1036" cy="99.2656" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1024" x2="1048" y1="113.2656" y2="113.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1003.5" y="1365.7793">userSeat</text><ellipse cx="1036" cy="1384.7324" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1024" x2="1048" y1="1398.7324" y2="1398.7324"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="1078.5" y="128.8008">Pool SML:BUCK</text><path d="M1114.5,79.2656 C1114.5,69.2656 1132.5,69.2656 1132.5,69.2656 C1132.5,69.2656 1150.5,69.2656 1150.5,79.2656 L1150.5,105.2656 C1150.5,115.2656 1132.5,115.2656 1132.5,115.2656 C1132.5,115.2656 1114.5,115.2656 1114.5,105.2656 L1114.5,79.2656 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1114.5,79.2656 C1114.5,89.2656 1132.5,89.2656 1132.5,89.2656 C1132.5,89.2656 1150.5,89.2656 1150.5,79.2656 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="1078.5" y="1365.7793">Pool SML:BUCK</text><path d="M1114.5,1378.7324 C1114.5,1368.7324 1132.5,1368.7324 1132.5,1368.7324 C1132.5,1368.7324 1150.5,1368.7324 1150.5,1378.7324 L1150.5,1404.7324 C1150.5,1414.7324 1132.5,1414.7324 1132.5,1414.7324 C1132.5,1414.7324 1114.5,1414.7324 1114.5,1404.7324 L1114.5,1378.7324 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1114.5,1378.7324 C1114.5,1388.7324 1132.5,1388.7324 1132.5,1388.7324 C1132.5,1388.7324 1150.5,1388.7324 1150.5,1378.7324 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="1224.5" y="128.8008">poolSeat SML:BUCK</text><ellipse cx="1293.5" cy="99.2656" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1281.5" x2="1305.5" y1="113.2656" y2="113.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="1224.5" y="1365.7793">poolSeat SML:BUCK</text><ellipse cx="1293.5" cy="1384.7324" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><line style="stroke:#181818;stroke-width:0.5;" x1="1281.5" x2="1305.5" y1="1398.7324" y2="1398.7324"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1372.5" y="128.8008">Pool MOOL:BUCK</text><path d="M1415.5,79.2656 C1415.5,69.2656 1433.5,69.2656 1433.5,69.2656 C1433.5,69.2656 1451.5,69.2656 1451.5,79.2656 L1451.5,105.2656 C1451.5,115.2656 1433.5,115.2656 1433.5,115.2656 C1433.5,115.2656 1415.5,115.2656 1415.5,105.2656 L1415.5,79.2656 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1415.5,79.2656 C1415.5,89.2656 1433.5,89.2656 1433.5,89.2656 C1433.5,89.2656 1451.5,89.2656 1451.5,79.2656 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="1372.5" y="1365.7793">Pool MOOL:BUCK</text><path d="M1415.5,1378.7324 C1415.5,1368.7324 1433.5,1368.7324 1433.5,1368.7324 C1433.5,1368.7324 1451.5,1368.7324 1451.5,1378.7324 L1451.5,1404.7324 C1451.5,1414.7324 1433.5,1414.7324 1433.5,1414.7324 C1433.5,1414.7324 1415.5,1414.7324 1415.5,1404.7324 L1415.5,1378.7324 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1415.5,1378.7324 C1415.5,1388.7324 1433.5,1388.7324 1433.5,1388.7324 C1433.5,1388.7324 1451.5,1388.7324 1451.5,1378.7324 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="0" x2="1514.5" y1="142.7539" y2="142.7539"/><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1514.5" x="0" y="164.4092"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1514.5" y1="164.4092" y2="164.4092"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1514.5" y1="167.4092" y2="167.4092"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="132" x="691.25" y="153.7539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="114" x="697.25" y="170.3223">Adding Liquidity</text><path d="M211,194.0645 L528,194.0645 L528,201.375 L518,211.375 L211,211.375 L211,194.0645 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:1.5;" width="985.5" x="211" y="194.0645"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="272" x="226" y="207.6328">discover existing proportion of balances</text><polygon fill="#181818" points="1120.5,228.6855,1130.5,232.6855,1120.5,236.6855,1124.5,232.6855" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="1126.5" y1="232.6855" y2="232.6855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="227.9434">100</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="294.5" y="227.5308">getPoolAllocation(SML)</text><polygon fill="#181818" points="267.5,257.9961,257.5,261.9961,267.5,265.9961,263.5,261.9961" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1131.5" y1="261.9961" y2="261.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="257.2539">101</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="304.5" y="256.8413">poolAllocation</text><path d="M211,283.9961 L340,283.9961 L340,291.3066 L330,301.3066 L211,301.3066 L211,283.9961 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:1.5;" width="556" x="211" y="283.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="84" x="226" y="297.5645">create invite</text><polygon fill="#181818" points="691.5,318.6172,701.5,322.6172,691.5,326.6172,695.5,322.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="697.5" y1="322.6172" y2="322.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="317.875">102</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="294.5" y="317.4624">makeAddLiquidityInvitation</text><polygon fill="#181818" points="267.5,347.9277,257.5,351.9277,267.5,355.9277,263.5,351.9277" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="702.5" y1="351.9277" y2="351.9277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="347.1855">103</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="80" x="304.5" y="346.7729">invitation</text><path d="M211,373.9277 L361,373.9277 L361,381.2383 L351,391.2383 L211,391.2383 L211,373.9277 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="74.9316" style="stroke:#000000;stroke-width:1.5;" width="383.5" x="211" y="373.9277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="105" x="226" y="387.4961">create proposal</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="427.8594" y2="427.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="427.8594" y2="440.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="440.8594" y2="440.8594"/><polygon fill="#181818" points="267.5,436.8594,257.5,440.8594,267.5,444.8594,263.5,440.8594" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="415.4619">104</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="294.5" y="407.8066">Create</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="338.5" y="407.4829">proposal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="406.5" y="407.8066">to add 1 BUCK, and 1 SML</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="294.5" y="423.1172">at ratio of</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="360.5" y="422.7935">poolAllocation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="476.5" y="423.1172">for X</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="72" x="510.5" y="422.7935">liquidity</text><path d="M211,462.8594 L362,462.8594 L362,470.1699 L352,480.1699 L211,480.1699 L211,462.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="538.2793" style="stroke:#000000;stroke-width:1.5;" width="1161.5" x="211" y="462.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="226" y="476.4277">withdraw funds</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="501.4805" y2="501.4805"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="501.4805" y2="514.4805"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="514.4805" y2="514.4805"/><polygon fill="#181818" points="267.5,510.4805,257.5,514.4805,267.5,518.4805,263.5,514.4805" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="496.7383">105</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="294.5" y="496.7383">withdraw funds for</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="417.5" y="496.4146">BUCK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25" x="453.5" y="496.7383">into</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="482.5" y="496.4146">payments</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="550.5" y="496.7383">record</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="543.791" y2="543.791"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="543.791" y2="556.791"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="556.791" y2="556.791"/><polygon fill="#181818" points="267.5,552.791,257.5,556.791,267.5,560.791,263.5,556.791" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="539.0488">106</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="294.5" y="539.0488">withdraw funds for</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="417.5" y="538.7251">SML</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25" x="445.5" y="539.0488">into</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="474.5" y="538.7251">payments</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="542.5" y="539.0488">record</text><polygon fill="#181818" points="771,582.1016,781,586.1016,771,590.1016,775,586.1016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="777" y1="586.1016" y2="586.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="581.3594">107</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="296" x="294.5" y="580.9468">offer(invitation, proposal, payments)</text><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="825" y1="615.4121" y2="615.4121"/><line style="stroke:#181818;stroke-width:1.0;" x1="825" x2="825" y1="615.4121" y2="628.4121"/><line style="stroke:#181818;stroke-width:1.0;" x1="784" x2="825" y1="628.4121" y2="628.4121"/><polygon fill="#181818" points="794,624.4121,784,628.4121,794,632.4121,790,628.4121" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="790" y="610.6699">108</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="821" y="610.6699">validate offer</text><polygon fill="#181818" points="1024,653.7227,1034,657.7227,1024,661.7227,1028,657.7227" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="1030" y1="657.7227" y2="657.7227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="790" y="652.9805">109</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="821" y="652.9805">create</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="863" y="652.6567">userSeat</text><polygon fill="#181818" points="794,683.0332,784,687.0332,794,691.0332,790,687.0332" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="788" x2="1035" y1="687.0332" y2="687.0332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="800" y="682.291">110</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="831" y="681.8784">userSeat</text><polygon fill="#181818" points="1120.5,712.3438,1130.5,716.3438,1120.5,720.3438,1124.5,716.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="1126.5" y1="716.3438" y2="716.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="790" y="711.6016">111</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="821" y="711.189">getPoolSeat()</text><polygon fill="#181818" points="1281.5,741.6543,1291.5,745.6543,1281.5,749.6543,1285.5,745.6543" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1132.5" x2="1287.5" y1="745.6543" y2="745.6543"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="1139.5" y="740.9121">112</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="1170.5" y="740.9121">create</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="1212.5" y="740.5884">poolSeat</text><polygon fill="#181818" points="794,770.9648,784,774.9648,794,778.9648,790,774.9648" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="788" x2="1292.5" y1="774.9648" y2="774.9648"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="800" y="770.2227">113</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="831" y="769.8101">poolSeat</text><polygon fill="#181818" points="1281.5,800.2754,1291.5,804.2754,1281.5,808.2754,1285.5,804.2754" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="1287.5" y1="804.2754" y2="804.2754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="790" y="799.5332">114</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="821" y="799.1206">addLiquidity</text><polygon fill="#181818" points="1281.5,829.5859,1291.5,833.5859,1281.5,837.5859,1285.5,833.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="703.5" x2="1287.5" y1="833.5859" y2="833.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="710.5" y="828.8438">115</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="741.5" y="828.8438">stage assets</text><polygon fill="#181818" points="1024,858.8965,1034,862.8965,1024,866.8965,1028,862.8965" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="703.5" x2="1030" y1="862.8965" y2="862.8965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="710.5" y="858.1543">116</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="741.5" y="858.1543">stage assets</text><line style="stroke:#181818;stroke-width:1.0;" x1="783" x2="825" y1="892.207" y2="892.207"/><line style="stroke:#181818;stroke-width:1.0;" x1="825" x2="825" y1="892.207" y2="905.207"/><line style="stroke:#181818;stroke-width:1.0;" x1="784" x2="825" y1="905.207" y2="905.207"/><polygon fill="#181818" points="794,901.207,784,905.207,794,909.207,790,905.207" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="790" y="887.4648">117</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="208" x="821" y="887.0522">reallocate(seat, poolSeat)</text><polygon fill="#181818" points="267.5,930.5176,257.5,934.5176,267.5,938.5176,263.5,934.5176" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1035" y1="934.5176" y2="934.5176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="929.7754">118</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="304.5" y="929.3628">userSeat</text><polygon fill="#181818" points="771,959.8281,781,963.8281,771,967.8281,775,963.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="777" y1="963.8281" y2="963.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="959.0859">119</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="294.5" y="958.6733">getOfferResult()</text><polygon fill="#181818" points="267.5,989.1387,257.5,993.1387,267.5,997.1387,263.5,993.1387" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="782" y1="993.1387" y2="993.1387"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="988.3965">120</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="304.5" y="988.3965">result of failure or success</text><path d="M211,1015.1387 L372,1015.1387 L372,1022.4492 L362,1032.4492 L211,1032.4492 L211,1015.1387 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="320.1055" style="stroke:#000000;stroke-width:1.5;" width="867.5" x="211" y="1015.1387"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="116" x="226" y="1028.707">recovering funds</text><polygon fill="#181818" points="1024,1049.7598,1034,1053.7598,1024,1057.7598,1028,1053.7598" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="1030" y1="1053.7598" y2="1053.7598"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="1049.0176">121</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="294.5" y="1048.6938">getPayout("Central")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="458.5" y="1049.0176">(give)</text><polygon fill="#181818" points="267.5,1079.0703,257.5,1083.0703,267.5,1087.0703,263.5,1083.0703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1035" y1="1083.0703" y2="1083.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="1078.3281">122</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="304.5" y="1077.9155">payoutCentral</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="1112.3809" y2="1112.3809"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="1112.3809" y2="1125.3809"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="1125.3809" y2="1125.3809"/><polygon fill="#181818" points="267.5,1121.3809,257.5,1125.3809,267.5,1129.3809,263.5,1125.3809" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="1107.6387">123</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="294.5" y="1107.6387">deposit</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="345.5" y="1107.3149">payoutCentral</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="453.5" y="1107.6387">into purse</text><polygon fill="#181818" points="1024,1150.6914,1034,1154.6914,1024,1158.6914,1028,1154.6914" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="1030" y1="1154.6914" y2="1154.6914"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="1149.9492">124</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="294.5" y="1149.6255">getPayout("Secondary")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="474.5" y="1149.9492">(give)</text><polygon fill="#181818" points="267.5,1180.002,257.5,1184.002,267.5,1188.002,263.5,1184.002" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1035" y1="1184.002" y2="1184.002"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="1179.2598">125</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="304.5" y="1178.8472">payoutSecondary</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="1213.3125" y2="1213.3125"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="1213.3125" y2="1226.3125"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="1226.3125" y2="1226.3125"/><polygon fill="#181818" points="267.5,1222.3125,257.5,1226.3125,267.5,1230.3125,263.5,1226.3125" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="1208.5703">126</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="294.5" y="1208.5703">deposit</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="345.5" y="1208.2466">payoutSecondary</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="469.5" y="1208.5703">into purse</text><polygon fill="#181818" points="1024,1251.623,1034,1255.623,1024,1259.623,1028,1255.623" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="1030" y1="1255.623" y2="1255.623"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="1250.8809">127</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="294.5" y="1250.5571">getPayout("Liquidity")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="474.5" y="1250.8809">(want)</text><polygon fill="#181818" points="267.5,1280.9336,257.5,1284.9336,267.5,1288.9336,263.5,1284.9336" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="261.5" x2="1035" y1="1284.9336" y2="1284.9336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="273.5" y="1280.1914">128</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="304.5" y="1279.7788">payoutLiquidity</text><line style="stroke:#181818;stroke-width:1.0;" x1="256.5" x2="298.5" y1="1314.2441" y2="1314.2441"/><line style="stroke:#181818;stroke-width:1.0;" x1="298.5" x2="298.5" y1="1314.2441" y2="1327.2441"/><line style="stroke:#181818;stroke-width:1.0;" x1="257.5" x2="298.5" y1="1327.2441" y2="1327.2441"/><polygon fill="#181818" points="267.5,1323.2441,257.5,1327.2441,267.5,1331.2441,263.5,1327.2441" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="263.5" y="1309.502">129</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="294.5" y="1309.502">deposit</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="345.5" y="1309.1782">payoutLiquidity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="469.5" y="1309.502">into purse</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="0" x2="1514.5" y1="1342.2441" y2="1342.2441"/><rect height="11.7773" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="176" x="1337.5" y="5"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="176" x="1337.5" y="14.668">Agoric Systems Operating Company.</text><rect height="11.7773" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="55" x="729.25" y="1433.7324"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="55" x="729.25" y="1443.4004">Page 3 of 4</text><!--MD5=[2d5f5151fc66bc58df860485dc589436]
@startuml
'https://plantuml.com/sequence-diagram
header Agoric Systems Operating Company.
footer Page %page% of %lastpage%
title Multipool Auto Swap Sequence Diagram Creation

autonumber
actor "MPAS Creator" as masc #lime
actor "Pool Adder N" as pa #yellow
actor "Pool User" as pu
database "MPAS Contract" as mpas
box "Zoe"
entity "Zoe" as zoe
entity "userSeat" as usA
end box

== MPAS Creation ==
masc -> mpas: Create instance
return ""creatorFacet""
== Pool Addition SML:BCK==
autonumber 10
pa -> mpas: ""addPool()""
database "Pool SML:BUCK" as pool
entity "poolSeat SML:BUCK" as psA

mpas -> pool: Create pool for SML -> BUCK
mpas - -> pa: ""Issuer""
== Pool Addition MOOL:BCK==
autonumber 10
pa -> mpas: ""addPool()""
database "Pool MOOL:BUCK" as pool2
mpas -> pool2: Create pool for MOOL -> BUCK
mpas - -> pa: ""Issuer""


== Duplicate Pool Addition MOOL:BCK==
autonumber 30
pa -> mpas: ""addPool()""
mpas - ->x pa: pool for MOOL:BCK already exists
newpage Multipool Auto Swap Sequence Diagram Swap Request

autonumber 50
== Swap Request ==
group asking for the current price UNK:BUCK
pu -> mpas: ""getOutputPrice(UNK:BUCK)""
mpas - ->x pu: ""brands were not recognized""
end
group asking for the current price MOOL:BUCK


pu -> mpas: ""getOutputPrice(MOOL:BUCK)""
mpas -> pool2: ""getPriceGivenRequiredOutput(MOOL:BUCK)""
pool2 - -> mpas: ""quote""
mpas - -> pu: ""quote""
end

group making a proposal
pu -> pu: create proposal for SML:BUCK as ""proposal""

end

group requesting an invitation for a SwapOut
pu -> mpas: ""makeSwapOutInvitation()""
return ""invitation""

end

group making an offer
pu -> pu: withdraw funds from purse of SML into ""payment""
pu -> zoe: ""offer(invitation, proposal, payment))""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

newpage Multipool Auto Swap Sequence Diagram Adding Liquidity

autonumber 100
== Adding Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> mpas: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to add 1 BUCK, and 1 SML\nat ratio of ""poolAllocation"" for X ""liquidity""
end
group withdraw funds
pu -> pu: withdraw funds for ""BUCK"" into ""payments"" record
pu -> pu: withdraw funds for ""SML"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (give)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
pu -> usA: ""getPayout("Liquidity")"" (want)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
end


newpage Multipool Auto Swap Sequence Diagram Removing Liquidity

autonumber 200
== Removing Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> mpas: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to remove 1 ""liquidity"" for 1 BUCK and 1 SML\nat ratio of ""poolAllocation""
end
group withdraw funds
pu -> pu: withdraw funds for ""liquidity"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Liquidity")"" (give)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
pu -> usA: ""getPayout("Central")"" (want)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

@enduml

@startuml
header Agoric Systems Operating Company.
footer Page %page% of %lastpage%
title Multipool Auto Swap Sequence Diagram Creation

autonumber
actor "MPAS Creator" as masc #lime
actor "Pool Adder N" as pa #yellow
actor "Pool User" as pu
database "MPAS Contract" as mpas
box "Zoe"
entity "Zoe" as zoe
entity "userSeat" as usA
end box

== MPAS Creation ==
masc -> mpas: Create instance
return ""creatorFacet""
== Pool Addition SML:BCK==
autonumber 10
pa -> mpas: ""addPool()""
database "Pool SML:BUCK" as pool
entity "poolSeat SML:BUCK" as psA

mpas -> pool: Create pool for SML -> BUCK
mpas - -> pa: ""Issuer""
== Pool Addition MOOL:BCK==
autonumber 10
pa -> mpas: ""addPool()""
database "Pool MOOL:BUCK" as pool2
mpas -> pool2: Create pool for MOOL -> BUCK
mpas - -> pa: ""Issuer""


== Duplicate Pool Addition MOOL:BCK==
autonumber 30
pa -> mpas: ""addPool()""
mpas - ->x pa: pool for MOOL:BCK already exists
newpage Multipool Auto Swap Sequence Diagram Swap Request

autonumber 50
== Swap Request ==
group asking for the current price UNK:BUCK
pu -> mpas: ""getOutputPrice(UNK:BUCK)""
mpas - ->x pu: ""brands were not recognized""
end
group asking for the current price MOOL:BUCK


pu -> mpas: ""getOutputPrice(MOOL:BUCK)""
mpas -> pool2: ""getPriceGivenRequiredOutput(MOOL:BUCK)""
pool2 - -> mpas: ""quote""
mpas - -> pu: ""quote""
end

group making a proposal
pu -> pu: create proposal for SML:BUCK as ""proposal""

end

group requesting an invitation for a SwapOut
pu -> mpas: ""makeSwapOutInvitation()""
return ""invitation""

end

group making an offer
pu -> pu: withdraw funds from purse of SML into ""payment""
pu -> zoe: ""offer(invitation, proposal, payment))""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

newpage Multipool Auto Swap Sequence Diagram Adding Liquidity

autonumber 100
== Adding Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> mpas: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to add 1 BUCK, and 1 SML\nat ratio of ""poolAllocation"" for X ""liquidity""
end
group withdraw funds
pu -> pu: withdraw funds for ""BUCK"" into ""payments"" record
pu -> pu: withdraw funds for ""SML"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Central")"" (give)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (give)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
pu -> usA: ""getPayout("Liquidity")"" (want)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
end


newpage Multipool Auto Swap Sequence Diagram Removing Liquidity

autonumber 200
== Removing Liquidity ==
group discover existing proportion of balances
pu -> pool: ""getPoolAllocation(SML)""
return ""poolAllocation""
end
group create invite
pu -> mpas: ""makeAddLiquidityInvitation""
return ""invitation""
end


group create proposal
pu -> pu: Create ""proposal"" to remove 1 ""liquidity"" for 1 BUCK and 1 SML\nat ratio of ""poolAllocation""
end
group withdraw funds
pu -> pu: withdraw funds for ""liquidity"" into ""payments"" record
pu -> zoe: ""offer(invitation, proposal, payments)""
zoe -> zoe: validate offer

zoe -> usA: create ""userSeat""
usA - -> zoe: ""userSeat""
zoe -> pool: ""getPoolSeat()""
pool -> psA: create ""poolSeat""
psA - -> zoe: ""poolSeat""

zoe -> psA: ""addLiquidity""
mpas -> psA: stage assets
mpas -> usA: stage assets
zoe -> zoe: ""reallocate(seat, poolSeat)""

usA - -> pu: ""userSeat""
pu -> zoe: ""getOfferResult()""
return result of failure or success
end
group recovering funds
pu -> usA: ""getPayout("Liquidity")"" (give)
return ""payoutLiquidity""
pu -> pu: deposit ""payoutLiquidity"" into purse
pu -> usA: ""getPayout("Central")"" (want)
return ""payoutCentral""
pu -> pu: deposit ""payoutCentral"" into purse
pu -> usA: ""getPayout("Secondary")"" (want)
return ""payoutSecondary""
pu -> pu: deposit ""payoutSecondary"" into purse
end

@enduml

PlantUML version 1.2022.2(Sat Mar 05 08:30:19 PST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>